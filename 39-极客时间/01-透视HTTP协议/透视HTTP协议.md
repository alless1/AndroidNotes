# é€è§†HTTPåè®®

## ç ´å†°ç¯‡

### 01ï½œæ—¶åŠ¿ä¸è‹±é›„ï¼šHTTPçš„å‰ä¸–ä»Šç”Ÿ

#### å°ç»“

1. HTTPåè®®å§‹äºä¸‰åå¹´å‰è’‚å§†Â·ä¼¯çº³æ–¯-æçš„ä¸€ç¯‡è®ºæ–‡ï¼›
2. HTTP/0.9æ˜¯ä¸ªç®€å•çš„æ–‡æœ¬åè®®ï¼Œåªèƒ½è·å–æ–‡æœ¬èµ„æºï¼›
3. HTTP/1.0ç¡®ç«‹äº†å¤§éƒ¨åˆ†ç°åœ¨ä½¿ç”¨çš„æŠ€æœ¯ï¼Œä½†å®ƒä¸æ˜¯æ­£å¼æ ‡å‡†ï¼›
4. HTTP/1.1æ˜¯ç›®å‰äº’è”ç½‘ä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„åè®®ï¼ŒåŠŸèƒ½ä¹Ÿéå¸¸å®Œå–„ï¼›
5. HTTP/2åŸºäºGoogleçš„SPDYåè®®ï¼Œæ³¨é‡æ€§èƒ½æ”¹å–„ï¼Œä½†æœªæ™®åŠï¼›
6. HTTP/3åŸºäºGoogleçš„QUICåè®®ï¼Œæ˜¯å°†æ¥çš„å‘å±•æ–¹å‘ï¼›

#### è¯¾ä¸‹ä½œä¸š

1. ä½ è®¤ä¸ºæ¨åŠ¨HTTPå‘å±•çš„åŸåŠ¨åŠ›æ˜¯ä»€ä¹ˆï¼Ÿ
2. ä½ æ˜¯æ€ä¹ˆç†è§£HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ï¼Ÿ

#### ä½œä¸šå›ç­”

1. æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜å¯ä»¥åº”ç”¨äºä»»ä½•ç§‘æŠ€æŠ€æœ¯ï¼Œç§‘æŠ€æŠ€æœ¯å‘å±•çš„åŸåŠ¨åŠ›ï¼Œå› ä¸ºç¤¾ä¼šè¦è¿›æ­¥å‘€ã€‚
2. å±äºä¼—å¤šåº”ç”¨å±‚åè®®çš„ä¸€ç§ï¼Œåº”ç”¨æ¯”è¾ƒå¹¿æ³›ã€‚

### 02ï½œHTTPæ˜¯ä»€ä¹ˆï¼ŸHTTPåˆä¸æ˜¯ä»€ä¹ˆï¼Ÿ

#### æ¦‚å¿µ

* HTTPå°±æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¹Ÿå°±æ˜¯ HyperText Transfer Protocolã€‚
* HTTPæ˜¯ä¸€ä¸ªåè®®ï¼Œè§„å®šäº†HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´äº¤æµé€šä¿¡çš„è§„èŒƒï¼Œä»¥åŠç›¸å…³çš„å„ç§æ§åˆ¶å’Œé”™è¯¯å¤„ç†æ–¹å¼ã€‚

#### å°ç»“

1. HTTPæ˜¯ä¸€ä¸ªç”¨åœ¨è®¡ç®—æœºä¸–ç•Œé‡Œçš„åè®®ï¼Œå®ƒç¡®ç«‹äº†ä¸€ç§è®¡ç®—æœºä¹‹é—´äº¤æµé€šä¿¡çš„è§„èŒƒï¼Œä»¥åŠç›¸å…³çš„å„ç§æ§åˆ¶å’Œé”™è¯¯å¤„ç†æ–¹å¼ã€‚
2. HTTPä¸“é—¨ç”¨æ¥åœ¨ä¸¤ç‚¹ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œä¸èƒ½ç”¨äºå¹¿æ’­ã€å¯»å€æˆ–è·¯ç”±ã€‚
3. HTTPä¼ è¾“çš„æ˜¯æ–‡å­—ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰è¶…æ–‡æœ¬æ•°æ®ã€‚
4. HTTPæ˜¯æ„å»ºäº’è”ç½‘çš„é‡è¦åŸºç¡€æŠ€æœ¯ï¼Œå®ƒæ²¡æœ‰å®ä½“ï¼Œä¾èµ–è®¸å¤šå…¶ä»–çš„æŠ€æœ¯æ¥å®ç°ï¼Œä½†åŒæ—¶è®¸å¤šæŠ€æœ¯ä¹Ÿéƒ½ä¾èµ–äºå®ƒã€‚

![HTTPæ€ç»´å¯¼å›¾](./img/HTTPæ€ç»´å¯¼å›¾.png)

#### è¯¾ä¸‹ä½œä¸š

1. æœ‰ä¸€ç§æµè¡Œçš„è¯´æ³•ï¼šâ€œHTTPæ˜¯ç”¨äºä»äº’è”ç½‘æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„åè®®â€œï¼Œä½ è®¤ä¸ºè¿™ç§è¯´æ³•å¯¹å—ï¼Ÿå¯¹åœ¨å“ªé‡Œï¼Œåˆé”™åœ¨å“ªé‡Œï¼Ÿ
2. ä½ èƒ½å†è¯´å‡ºå‡ ä¸ªâ€HTTPä¸æ˜¯ä»€ä¹ˆâ€œå—ï¼Ÿ

#### ä½œä¸šå›ç­”

1. å¯¹ï¼Œä½†ä¸å‡†ç¡®ã€‚HTTPæ˜¯ç”¨äºè§„å®šä»è®¡ç®—æœºå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®çš„ä¸€ç§åè®®ï¼Œé€šè®¯æ•°æ®å¯ä»¥ä½¿ç”¨è¶…æ–‡æœ¬ã€‚
2. é‚£å°±å¤ªå¤šäº†ã€‚

### 03 |ä¸HTTPç›¸å…³çš„å„ç§æ¦‚å¿µ

![ä¸httpç›¸å…³çš„æ¦‚å¿µ](./img/httpç›¸å…³çš„æ¦‚å¿µ.png)

#### å°ç»“

1. äº’è”ç½‘ä¸Šç»å¤§éƒ¨åˆ†èµ„æºéƒ½ä½¿ç”¨HTTPåè®®ä¼ è¾“ï¼›
2. æµè§ˆå™¨æ˜¯HTTPåè®®é‡Œçš„è¯·æ±‚æ–¹ï¼Œå³User Agentï¼›
3. æœåŠ¡å™¨æ˜¯HTTPåè®®é‡Œçš„åº”ç­”æ–¹ï¼Œå¸¸ç”¨çš„æœ‰Apacheå’ŒNginxï¼›
4. CDNï¼ˆContent Delivery Networkï¼‰ä½äºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¸»è¦èµ·åˆ°ç¼“å­˜åŠ é€Ÿçš„ä½œç”¨ï¼›
5. çˆ¬è™«æ˜¯å¦ä¸€ç±»User Agentï¼Œæ˜¯è‡ªåŠ¨è®¿é—®ç½‘ç»œèµ„æºçš„ç¨‹åºã€‚

#### è¯¾ä¸‹ä½œä¸š

1. ä½ è§‰å¾—CDNåœ¨å¯¹å¾…æµè§ˆå™¨å’Œçˆ¬è™«æ—¶ä¼šæœ‰å·®å¼‚å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
2. ä½ æ€ä¹ˆç†è§£WebServiceä¸Web Serverè¿™ä¸¤ä¸ªéå¸¸ç›¸ä¼¼çš„è¯ï¼Ÿ

#### ä½œä¸šå›ç­”

1. æ²¡æœ‰ï¼Œæ— æ³•åˆ¤æ–­è¯·æ±‚æ–¹ã€‚
2. å¼•ç”¨ï¼šserviceé€šå¸¸æ˜¯æŒ‡æœåŠ¡ç¨‹åºï¼Œè·‘åœ¨serverä¸Šï¼Œserverå¯ä»¥ç†è§£æˆå®¹å™¨ã€å¹³å°ã€‚ï¼ˆä¸ªäººä»å­—é¢ä¸Šç†è§£å§ï¼ŒserveræœåŠ¡å™¨ï¼ŒserviceæœåŠ¡ğŸ˜‚ï¼‰

### 04ï½œä¸HTTPç›¸å…³çš„å„ç§åè®®

![httpç›¸å…³çš„åè®®](./img/httpç›¸å…³çš„åè®®.png)

#### å°ç»“

1. TCP/IPæ˜¯ç½‘ç»œä¸–ç•Œæœ€å¸¸ç”¨çš„åè®®ï¼ŒHTTPé€šå¸¸è¿è¡Œåœ¨TCP/IPæä¾›çš„å¯é ä¼ è¾“åŸºç¡€ä¸Šï¼›
2. DNSåŸŸåæ˜¯IPåœ°å€çš„ç­‰ä»·æ›¿ä»£ï¼Œéœ€è¦ç”¨åŸŸåè§£æå®ç°åˆ°IPåœ°å€çš„æ˜ å°„ï¼›
3. URIæ˜¯ç”¨æ¥æ ‡è®°äº’è”ç½‘ä¸Šèµ„æºçš„ä¸€ä¸ªåå­—ï¼Œç”±â€åè®®å+ä¸»æœºå+è·¯å¾„â€œæ„æˆï¼Œä¿—ç§°URLï¼›
4. HTTPSç›¸å½“äºâ€HTTP+SSL/TLS+TCP/IPâ€œï¼Œä¸ºHTTPå¥—äº†ä¸€ä¸ªå®‰å…¨çš„å¤–å£³ï¼›
5. ä»£ç†æ˜¯HTTPä¼ è¾“è¿‡ç¨‹ä¸­çš„â€ä¸­è½¬ç«™â€œï¼Œå¯ä»¥å®ç°ç¼“å­˜åŠ é€Ÿã€è´Ÿè´£å‡è¡¡ç­‰åŠŸèƒ½ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. DNSä¸URIæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ
2. åœ¨è®²ä»£ç†æ—¶æˆ‘ç‰¹æ„æ²¡æœ‰ä¸¾ä¾‹è¯´æ˜ï¼Œä½ èƒ½å¤Ÿå¼•å…¥ä¸€ä¸ªâ€å°å¼ºâ€œçš„è§’è‰²ï¼Œé€šè¿‡æ‰“ç”µè¯æ¥æ¯”å–»ä¸€ä¸‹å—ï¼Ÿ

#### ä½œä¸šå›ç­”

1. URIï¼ˆUniform Resource Identifierï¼‰ï¼Œä¸­æ–‡åç§°æ˜¯ ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼Œä½¿ç”¨å®ƒå°±èƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è®°äº’è”ç½‘ä¸Šèµ„æºï¼ŒDNSæ˜¯ç”¨æ¥å°†URIä¸­çš„åŸŸåè§£æä¸ºIpåœ°å€çš„ã€‚
2. ä½ æ‰“ç”µè¯ç»™å°å¼ºï¼Œè®©å°å¼ºå»æ‰¾å°æ˜æ¥æ¥ç”µè¯ã€‚

### 05ï½œå››å±‚å’Œä¸ƒå±‚ç½‘ç»œæ¨¡å‹

#### å››å±‚ç½‘ç»œæ¨¡å‹

> TCP/IP åè®®æ€»å…±æœ‰å››å±‚ï¼Œå°±åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œæ¯ä¸€å±‚éœ€è¦ä¸‹å±‚çš„æ”¯æ’‘ï¼ŒåŒæ—¶åˆæ”¯æ’‘ç€ä¸Šå±‚ï¼Œä»»ä½•ä¸€å±‚è¢«æŠ½æ‰éƒ½å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªåè®®æ ˆåå¡Œã€‚

![TCP/IPåè®®å±‚](./img/TcpIpåè®®å±‚.png)

* ç¬¬ä¸€å±‚æ˜¯â€œé“¾æ¥å±‚â€ï¼ˆlink layerï¼‰ï¼Œè´Ÿè´£åœ¨ä»¥å¤ªç½‘ã€Wi-Fiè¿™æ ·çš„åº•å±‚ç½‘ç»œä¸Šå‘é€åŸå§‹æ•°æ®åŒ…ï¼Œå·¥ä½œåœ¨ç½‘å¡è¿™ä¸ªå±‚æ¬¡ï¼Œä½¿ç”¨MACåœ°å€æ¥æ ‡è®°ç½‘ç»œä¸Šçš„è®¾å¤‡ã€‚
* ç¬¬äºŒå±‚æ˜¯"ç½‘ç»œå±‚"ï¼ˆinternet layerï¼‰ï¼ŒIPåè®®åœ¨è¿™ä¸€å±‚ã€‚
* ç¬¬ä¸‰å±‚æ˜¯â€œä¼ è¾“å±‚â€ï¼ˆtransport layerï¼‰ï¼Œä¿è¯æ•°æ®åœ¨ä¸¤ç‚¹ä¹‹é—´çš„ä¼ è¾“ï¼ŒTCPã€UDPåè®®ã€‚
* ç¬¬å››å±‚æ˜¯â€œåº”ç”¨å±‚â€ï¼ˆapplication layerï¼‰ï¼ŒHTTPã€Telnetã€SSHã€FTPã€SMTP

#### ä¸ƒå±‚ç½‘ç»œæ¨¡å‹

> OSIï¼Œå…¨ç§°æ˜¯â€œå¼€æ”¾å¼ç³»ç»Ÿäº’è”é€šä¿¡å‚è€ƒæ¨¡å‹â€ï¼ˆOpen System Interconnection Reference Modelï¼‰ã€‚

![osiç½‘ç»œæ¨¡å‹](./img/osiç½‘ç»œæ¨¡å‹.png)

* ç¬¬ä¸€å±‚ï¼šç‰©ç†å±‚ï¼Œç½‘ç»œçš„ç‰©ç†å½¢å¼ï¼Œä¾‹å¦‚ç”µç¼†ã€å…‰çº¤ã€ç½‘å¡ã€é›†çº¿å™¨ç­‰ï¼›
* ç¬¬äºŒå±‚ï¼šæ•°æ®é“¾è·¯å±‚ï¼Œå®ƒåŸºæœ¬ç›¸å½“äºTCP/IPçš„é“¾æ¥å±‚ï¼›
* ç¬¬ä¸‰å±‚ï¼šç½‘ç»œå±‚ï¼Œç›¸å½“äºTCP/IPé‡Œçš„ç½‘é™…å±‚ï¼›
* ç¬¬å››å±‚ï¼šä¼ è¾“å±‚ï¼Œç›¸å½“äºTCP/IPé‡Œçš„ä¼ è¾“å±‚ï¼›
* ç¬¬äº”å±‚ï¼šä¼šè¯å±‚ï¼Œç»´æŠ¤ç½‘ç»œä¸­çš„è¿æ¥çŠ¶æ€ï¼Œå³ä¿æŒä¼šè¯å’ŒåŒæ­¥ï¼›
* ç¬¬å…­å±‚ï¼šè¡¨ç¤ºå±‚ï¼ŒæŠŠæ•°æ®è½¬æ¢ä¸ºåˆé€‚ã€å¯ç†è§£çš„è¯­æ³•å’Œè¯­ä¹‰ï¼›
* ç¬¬ä¸ƒå±‚ï¼šåº”ç”¨å±‚ï¼Œé¢å‘å…·ä½“çš„åº”ç”¨ä¼ è¾“æ•°æ®ã€‚

#### ä¸¤ç§æ¨¡å‹çš„å¯¹åº”å…³ç³»

![ä¸¤ç§æ¨¡å‹å¯¹åº”å…³ç³»](./img/ä¸¤ç§æ¨¡å‹å¯¹åº”å…³ç³».png)

* ç¬¬ä¸€å±‚ï¼šç‰©ç†å±‚ï¼ŒTCP/IPé‡Œæ— å¯¹åº”ï¼›
* ç¬¬äºŒå±‚ï¼šæ•°æ®é“¾è·¯å±‚ï¼Œå¯¹åº”TCP/IPçš„é“¾æ¥å±‚ï¼›
* ç¬¬ä¸‰å±‚ï¼šç½‘ç»œå±‚ï¼Œå¯¹åº”TCP/IPçš„ç½‘é™…å±‚ï¼›
* ç¬¬å››å±‚ï¼šä¼ è¾“å±‚ï¼Œå¯¹åº”TCP/IPçš„ä¼ è¾“å±‚ï¼›
* ç¬¬äº”ã€å…­ã€ä¸ƒå±‚ï¼šç»Ÿä¸€å¯¹åº”åˆ°TCP/IPçš„åº”ç”¨å±‚ã€‚

#### å°ç»“

1. TCP/IPåˆ†ä¸ºå››å±‚ï¼Œæ ¸å¿ƒæ˜¯äºŒå±‚çš„IPå’Œä¸‰å±‚çš„TCPï¼ŒHTTPåœ¨ç¬¬å››å±‚ï¼›
2. OSIåˆ†ä¸ºä¸ƒå±‚ï¼ŒåŸºæœ¬å¯¹åº”TCP/IPåè®®ï¼ŒTCPåœ¨ç¬¬å››å±‚ï¼ŒHTTPåœ¨ç¬¬ä¸ƒå±‚ï¼›
3. OSIå¯ä»¥æ˜ å°„åˆ°TCP/IPï¼Œä½†è¿™æœŸé—´ä¸€ã€äº”ã€å…­å±‚æ¶ˆå¤±äº†ï¼›
4. æ—¥å¸¸äº¤æµçš„æ—¶å€™æˆ‘ä»¬é€šå¸¸ä½¿ç”¨OSIæ¨¡å‹ï¼Œç”¨å››å±‚ã€ä¸ƒå±‚ç­‰æœ¯è¯­ï¼›
5. HTTPåˆ©ç”¨TCP/IPåè®®æ ˆé€å±‚æ‰“åŒ…å†æ‹†åŒ…ï¼Œå®ç°äº†æ•°æ®ä¼ è¾“ï¼Œä½†ä¸‹é¢çš„ç»†èŠ‚å¹¶ä¸å¯è§ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. ä½ èƒ½ç”¨è‡ªå·±çš„è¯è§£é‡Šä¸€ä¸‹â€œäºŒå±‚è½¬å‘â€â€œä¸‰å±‚è·¯ç”±â€å—ï¼Ÿ
2. ä½ è®¤ä¸ºä¸Šä¸€è®²ä¸­çš„DNSåè®®ä½äºå“ªä¸€å±‚å‘¢ï¼Ÿ
3. ä½ è®¤ä¸ºCDNå·¥ä½œåœ¨å“ªä¸€å±‚å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. è¿™é‡Œçš„äºŒå±‚å’Œä¸‰å±‚æŒ‡çš„éƒ½æ˜¯OSIä¸­çš„å¯¹åº”å±‚çº§ï¼ŒäºŒå±‚è½¬å‘æŒ‡çš„æ˜¯æ•°æ®é“¾è·¯å±‚ï¼ŒåŸºäºMACåœ°å€ï¼Œé€šå¸¸æ˜¯äº¤æ¢æœºï¼Œæ ¹æ®ç›®æ ‡MACåœ°å€ï¼Œè¿›è¡Œæœ¬åœ°è½¬å‘å’Œå¹¿æ’­ã€‚ä¸‰å±‚è·¯ç”±æŒ‡çš„æ˜¯ç½‘ç»œå±‚ï¼Œé€šå¸¸æ˜¯è·¯ç”±å™¨ï¼Œæ ¹æ®ç½‘æ®µèŒƒå›´ï¼Œè¿›è¡Œæœ¬åœ°è½¬å‘æˆ–é€‰æ‹©ä¸‹ä¸€ä¸ªç½‘å…³ã€‚

   > å½“æ•°æ®ä¼ è¾“åˆ°ç½‘ç»œå±‚ï¼Œè·¯ç”±å™¨ä¼šæ£€æŸ¥ç›®çš„ IP æ˜¯å¦ä¸è‡ªå·±å¤„äºåŒä¸€ç½‘æ®µï¼Œæ˜¯åˆ™è¿›è¡ŒäºŒå±‚è½¬å‘å³è¯·æ±‚ç›®çš„ä¸»æœºçš„ MAC åœ°å€ï¼Œå¦åˆ™è¿›è¡Œä¸‰å±‚è½¬å‘å³è¿›å…¥è·¯ç”±çš„é€’å½’æŸ¥æ‰¾ã€‚

2. DNSå±äºåº”ç”¨å±‚ï¼Œå…¶æœ¬èº«å¹¶ä¸è´Ÿè´£ä¼ è¾“ã€ç½‘é™…çš„å®é™…æ“ä½œï¼Œåªæ˜¯å°†åŸŸåè§£æä¸ºIPï¼Œæ–¹ä¾¿ä¸‹ä¸€å±‚çš„ä½¿ç”¨ï¼›

3. CDNå±äºåº”ç”¨å±‚ï¼Œæ˜¯å¯¹ä¼ è¾“åçš„æ•°æ®å†…å®¹æ“ä½œã€‚

### 06ï½œåŸŸåé‡Œæœ‰å“ªäº›é—¨é“ï¼Ÿ

#### åŸŸåçš„å½¢å¼

* åŸŸåæ˜¯ä¸€ä¸ªæœ‰å±‚æ¬¡çš„ç»“æ„ï¼Œæ˜¯ä¸€ä¸²ç”¨â€œ.â€åˆ†éš”çš„å¤šä¸ªå•è¯ï¼Œæœ€å³è¾¹çš„è¢«ç§°ä¸ºâ€œé¡¶çº§åŸŸåâ€ï¼Œç„¶åæ˜¯â€œäºŒçº§åŸŸåâ€ï¼Œå±‚çº§å…³ç³»å‘å·¦ä¾æ¬¡é™ä½ã€‚
* DNS çš„æ ¸å¿ƒç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸‰å±‚çš„æ ‘çŠ¶ã€åˆ†å¸ƒå¼æœåŠ¡ï¼ŒåŸºæœ¬å¯¹åº”åŸŸåçš„ç»“æ„ï¼š
  1. æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆRoot DNS Serverï¼‰ï¼šç®¡ç†é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œè¿”å›â€œcomâ€â€œnetâ€â€œcnâ€ç­‰é¡¶çº§åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼›
  2. é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆTop-level DNS Serverï¼‰ï¼šç®¡ç†å„è‡ªåŸŸåä¸‹çš„æƒå¨åŸŸåæœåŠ¡å™¨ï¼Œæ¯”å¦‚ com é¡¶çº§åŸŸåæœåŠ¡å™¨å¯ä»¥è¿”å› apple.com åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼›
  3. æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆAuthoritative DNS Serverï¼‰ï¼šç®¡ç†è‡ªå·±åŸŸåä¸‹ä¸»æœºçš„ IP åœ°å€ï¼Œæ¯”å¦‚ apple.com æƒå¨åŸŸåæœåŠ¡å™¨å¯ä»¥è¿”å› www.apple.com çš„ IP åœ°å€ã€‚

![åŸŸåç»“æ„](./img/åŸŸåç»“æ„.png)

#### å°ç»“

1. åŸŸåä½¿ç”¨å­—ç¬¦ä¸²æ¥ä»£æ›¿IPåœ°å€ï¼Œæ–¹ä¾¿ç”¨æˆ·è®°å¿†ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåå­—ç©ºé—´ç³»ç»Ÿï¼›
2. DNSå°±åƒæ˜¯æˆ‘ä»¬ç°å®ä¸–ç•Œé‡Œçš„ç”µè¯æœ¬ã€æŸ¥å·å°ï¼Œç»Ÿç®¡ç€äº’è”ç½‘ä¸–ç•Œé‡Œçš„æ‰€æœ‰ç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªâ€œè¶…çº§å¤§ç®¡å®¶â€ï¼›
3. DNSæ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„åˆ†å¸ƒå¼æŸ¥è¯¢ç³»ç»Ÿï¼Œä½†ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå¤–å›´æœ‰å¤šçº§çš„ç¼“å­˜ï¼›
4. ä½¿ç”¨DNSå¯ä»¥å®ç°åŸºäºåŸŸåçš„è´Ÿè½½å‡è¡¡ï¼Œæ—¢å¯ä»¥åœ¨å†…ç½‘ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–ç½‘ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. åœ¨æµè§ˆå™¨åœ°å€æ é‡Œéšä¾¿è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåï¼Œæ¯”å¦‚å°±å«â€œwww. ä¸å­˜åœ¨.comâ€ï¼Œè¯•ç€è§£é‡Šä¸€ä¸‹å®ƒçš„ DNS è§£æè¿‡ç¨‹ã€‚
2. å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼ŒDNS å¤±æ•ˆæˆ–è€…å‡ºé”™äº†ï¼Œä¼šå‡ºç°ä»€ä¹ˆåæœï¼Ÿ

#### ä½œä¸šç­”æ¡ˆ

1. æµè§ˆå™¨ç¼“å­˜->æ“ä½œç³»ç»Ÿç¼“å­˜->hosts->dns
2. ç»“æœå°±æ˜¯è®¿é—®ç½‘é¡µå¤±è´¥ï¼Œè¿‡ç¨‹ä¸çŸ¥ã€‚

### 07ï½œè‡ªå·±åŠ¨æ‰‹ï¼Œæ­å»ºHTTPå®éªŒç¯å¢ƒ

#### é…ç½®â€œæœ€å°åŒ–â€ç¯å¢ƒçš„åº”ç”¨è½¯ä»¶ï¼š

* Wiresharkï¼šæ˜¯è‘—åçš„ç½‘ç»œæŠ“åŒ…å·¥å…·ï¼Œèƒ½å¤Ÿæˆªè·åœ¨ TCP/IP åè®®æ ˆä¸­ä¼ è¾“çš„æ‰€æœ‰æµé‡ï¼Œå¹¶æŒ‰åè®®ç±»å‹ã€åœ°å€ã€ç«¯å£ç­‰ä»»æ„è¿‡æ»¤ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ˜¯å­¦ä¹ ç½‘ç»œåè®®çš„å¿…å¤‡å·¥å…·ã€‚
* Chrome/Firefoxï¼šæ˜¯ Google å¼€å‘çš„æµè§ˆå™¨ï¼Œæ˜¯ç›®å‰çš„ä¸»æµæµè§ˆå™¨ä¹‹ä¸€ã€‚å®ƒä¸ä»…ä¸Šç½‘æ–¹ä¾¿ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è°ƒè¯•å™¨ã€‚
* Telnetï¼šæ˜¯ä¸€ä¸ªç»å…¸çš„è™šæ‹Ÿç»ˆç«¯ï¼ŒåŸºäº TCP åè®®è¿œç¨‹ç™»å½•ä¸»æœºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ¨¡æ‹Ÿæµè§ˆå™¨çš„è¡Œä¸ºï¼Œè¿æ¥æœåŠ¡å™¨åæ‰‹åŠ¨å‘é€ HTTP è¯·æ±‚ï¼ŒæŠŠæµè§ˆå™¨çš„å¹²æ‰°ä¹Ÿå½»åº•æ’é™¤ï¼Œèƒ½å¤Ÿä»æœ€åŸå§‹çš„å±‚é¢å»ç ”ç©¶ HTTP åè®®ã€‚
* OpenRestyï¼šå®ƒæ˜¯åŸºäº Nginx çš„ä¸€ä¸ªâ€œå¼ºåŒ–åŒ…â€ï¼Œé‡Œé¢é™¤äº† Nginx è¿˜æœ‰ä¸€å¤§å †æœ‰ç”¨çš„åŠŸèƒ½æ¨¡å—ï¼Œä¸ä»…æ”¯æŒ HTTP/HTTPSï¼Œè¿˜ç‰¹åˆ«é›†æˆäº†è„šæœ¬è¯­è¨€ Lua ç®€åŒ– Nginx äºŒæ¬¡å¼€å‘ï¼Œæ–¹ä¾¿å¿«é€Ÿåœ°æ­å»ºåŠ¨æ€ç½‘å…³ï¼Œæ›´èƒ½å¤Ÿå½“æˆåº”ç”¨å®¹å™¨æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚

> å®ç°é¡¹ç›®åœ°å€ï¼š[http_study](https://github.com/chronolaw/http_study)

#### å°ç»“

1. ç°å®çš„ç½‘ç»œç¯å¢ƒå¤ªå¤æ‚ï¼Œæœ‰å¾ˆå¤šå¹²æ‰°å› ç´ ï¼Œæ­å»ºâ€œæœ€å°åŒ–â€çš„ç¯å¢ƒå¯ä»¥å¿«é€ŸæŠ“ä½é‡ç‚¹ï¼ŒæŒæ¡ HTTP çš„æœ¬è´¨ï¼›
2. æˆ‘ä»¬é€‰æ‹© Wireshark ä½œä¸ºæŠ“åŒ…å·¥å…·ï¼Œæ•è·åœ¨ TCP/IP åè®®æ ˆä¸­ä¼ è¾“çš„æ‰€æœ‰æµé‡ï¼›æˆ‘ä»¬é€‰æ‹© Chrome æˆ– Firefox æµè§ˆå™¨ä½œä¸º HTTP åè®®ä¸­çš„ user agentï¼›
3. æˆ‘ä»¬é€‰æ‹© OpenResty ä½œä¸º Web æœåŠ¡å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ª Nginx çš„â€œå¼ºåŒ–åŒ…â€ï¼ŒåŠŸèƒ½éå¸¸ä¸°å¯Œï¼›
4. Telnet æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ç”¨æ¥ç™»å½•ä¸»æœºæ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œï¼›
5. åœ¨ GitHub ä¸Šå¯ä»¥ä¸‹è½½åˆ°æœ¬ä¸“æ çš„ä¸“ç”¨é¡¹ç›®æºç ï¼Œåªè¦æŠŠ OpenResty è§£å‹åˆ°é‡Œé¢å³å¯å®Œæˆå®éªŒç¯å¢ƒçš„æ­å»ºã€‚

#### æ“ä½œï¼ˆMacï¼‰

* å¯åŠ¨é¡¹ç›®

  ~~~shell
  cd http_study/www/
  openresty -p `pwd` -c conf/nginx.conf
  ~~~

  åœæ­¢é¡¹ç›®

  ~~~shell
  openresty -s quit -p `pwd` -c conf/nginx.conf
  ~~~

  

## åŸºç¡€ç¯‡

### 08ï½œé”®å…¥ç½‘å€å†æŒ‰ä¸‹å›è½¦ï¼Œåé¢ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

#### äº¤äº’æµç¨‹

![httpè¯·æ±‚è¿‡ç¨‹](./img/httpè¯·æ±‚è¿‡ç¨‹.png)

#### å°ç»“

1. HTTP åè®®åŸºäºåº•å±‚çš„ TCP/IP åè®®ï¼Œæ‰€ä»¥å¿…é¡»è¦ç”¨ IP åœ°å€å»ºç«‹è¿æ¥ï¼›
2. å¦‚æœä¸çŸ¥é“ IP åœ°å€ï¼Œå°±è¦ç”¨ DNS åè®®å»è§£æå¾—åˆ° IP åœ°å€ï¼Œå¦åˆ™å°±ä¼šè¿æ¥å¤±è´¥ï¼›
3. å»ºç«‹ TCP è¿æ¥åä¼šé¡ºåºæ”¶å‘æ•°æ®ï¼Œè¯·æ±‚æ–¹å’Œåº”ç­”æ–¹éƒ½å¿…é¡»ä¾æ® HTTP è§„èŒƒæ„å»ºå’Œè§£ææŠ¥æ–‡ï¼› 
4. ä¸ºäº†å‡å°‘å“åº”æ—¶é—´ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªç¯èŠ‚éƒ½ä¼šæœ‰ç¼“å­˜ï¼Œèƒ½å¤Ÿå®ç°â€œçŸ­è·¯â€æ“ä½œï¼›
5. è™½ç„¶ç°å®ä¸­çš„ HTTP ä¼ è¾“è¿‡ç¨‹éå¸¸å¤æ‚ï¼Œä½†ç†è®ºä¸Šä»ç„¶å¯ä»¥ç®€åŒ–æˆå®éªŒé‡Œçš„â€œä¸¤ç‚¹â€æ¨¡å‹ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. ä½ èƒ½è¯•ç€è§£é‡Šä¸€ä¸‹åœ¨æµè§ˆå™¨é‡Œç‚¹å‡»é¡µé¢é“¾æ¥åå‘ç”Ÿäº†å“ªäº›äº‹æƒ…å—ï¼Ÿ
2. è¿™ä¸€èŠ‚è¯¾é‡Œè®²çš„éƒ½æ˜¯æ­£å¸¸çš„è¯·æ±‚å¤„ç†æµç¨‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåï¼Œé‚£ä¹ˆæµè§ˆå™¨çš„å·¥ä½œæµç¨‹ä¼šæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. 1. æµè§ˆå™¨ä»åœ°å€æ çš„è¾“å…¥ä¸­è·å¾—æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£å·ï¼›
   2. æµè§ˆå™¨ç”¨ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼›
   3. æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ‹¼å¥½çš„æŠ¥æ–‡ï¼›
   4. æœåŠ¡å™¨æ”¶åˆ°æŠ¥æ–‡åå¤„ç†è¯·æ±‚ï¼ŒåŒæ ·æ‹¼å¥½æŠ¥æ–‡å†å‘ç»™æµè§ˆå™¨ï¼›
   5. æµè§ˆå™¨è§£ææŠ¥æ–‡ï¼Œæ¸²æŸ“è¾“å‡ºé¡µé¢ã€‚
2. 1. æµè§ˆå™¨ä»åœ°å€æ çš„è¾“å…¥ä¸­è·å¾—æœåŠ¡å™¨çš„åŸŸåï¼› 
   2. è§£æåŸŸåï¼ˆæµè§ˆå™¨ç¼“å­˜->host->å±€åŸŸç½‘/å¹¿åŸŸç½‘ç¼“å­˜->æ ¹åŸŸåæœåŠ¡å™¨->é¡¶çº§åŸŸå->æƒå¨åŸŸåï¼‰ã€‚

### 09ï½œHTTPæŠ¥æ–‡æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ

#### åè®®ç»„æˆ

* HTTPåè®®çš„è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„ç»“æ„åŸºæœ¬ç›¸åŒï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼›
  1. èµ·å§‹è¡Œï¼ˆstart lineï¼‰ï¼šæè¿°è¯·æ±‚æˆ–å“åº”çš„åŸºæœ¬ä¿¡æ¯ï¼›
  2. å¤´éƒ¨å­—æ®µé›†åˆï¼ˆheaderï¼‰ï¼šä½¿ç”¨key-valueå½¢å¼æ›´è¯¦ç»†åœ°è¯´æ˜æŠ¥æ–‡ï¼›
  3. æ¶ˆæ¯æ­£æ–‡ï¼ˆbodyï¼‰ï¼šå®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå®ƒä¸ä¸€å®šæ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥æ˜¯å›¾ç‰‡ã€è§†é¢‘ç­‰äºŒè¿›åˆ¶æ•°æ®ã€‚
* èµ·å§‹è¡Œ+å¤´éƒ¨ï¼ˆheaderï¼‰+ç©ºè¡Œ+å®ä½“ï¼ˆbodyï¼‰

#### èµ·å§‹è¡Œæ ¼å¼

* è¯·æ±‚è¡Œï¼šè¯·æ±‚æ–¹æ³•+è¯·æ±‚ç›®æ ‡+ç‰ˆæœ¬å·ï¼Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚ï¼ˆä¾‹å¦‚ï¼šGET / HTTP/1.1ï¼‰

* çŠ¶æ€è¡Œï¼ˆå“åº”è¡Œï¼‰ï¼šç‰ˆæœ¬å·+çŠ¶æ€ç +åŸå› ï¼Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚ï¼ˆä¾‹å¦‚ï¼šHTTP/1.1 200 OKï¼‰

  ![httpè¯·æ±‚å¤´åè®®æ ¼å¼](./img/httpåè®®å¤´æ ¼å¼.png)

#### å¤´éƒ¨å­—æ®µè§„åˆ™

1. å­—å­—æ®µåä¸åŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚â€œHostâ€ä¹Ÿå¯ä»¥å†™æˆâ€œhostâ€ï¼Œä½†é¦–å­—æ¯å¤§å†™çš„å¯è¯»æ€§æ›´å¥½ï¼›
2. å­—æ®µåé‡Œä¸å…è®¸å‡ºç°ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨è¿å­—ç¬¦â€œ-â€ï¼Œä½†ä¸èƒ½ä½¿ç”¨ä¸‹åˆ’çº¿â€œ_â€ã€‚ä¾‹å¦‚ï¼Œâ€œtest-nameâ€æ˜¯åˆæ³•çš„å­—æ®µåï¼Œè€Œâ€œtest nameâ€â€œtest_nameâ€æ˜¯ä¸æ­£ç¡®çš„å­—æ®µåï¼›
3. å­—æ®µååé¢å¿…é¡»ç´§æ¥ç€â€œ:â€ï¼Œä¸èƒ½æœ‰ç©ºæ ¼ï¼Œè€Œâ€œ:â€åçš„å­—æ®µå€¼å‰å¯ä»¥æœ‰å¤šä¸ªç©ºæ ¼ï¼›
4. å­—æ®µçš„é¡ºåºæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¯ä»¥ä»»æ„æ’åˆ—ä¸å½±å“è¯­ä¹‰ï¼›
5. å­—æ®µåŸåˆ™ä¸Šä¸èƒ½é‡å¤ï¼Œé™¤éè¿™ä¸ªå­—æ®µæœ¬èº«çš„è¯­ä¹‰å…è®¸ï¼Œä¾‹å¦‚ Set-Cookieã€‚

#### å¤´éƒ¨å­—æ®µåˆ†ç±»

1. é€šç”¨å­—æ®µï¼šåœ¨è¯·æ±‚å¤´å’Œå“åº”å¤´é‡Œéƒ½å¯ä»¥å‡ºç°ï¼›ï¼ˆDateï¼‰
2. è¯·æ±‚å­—æ®µï¼šä»…èƒ½å‡ºç°åœ¨è¯·æ±‚å¤´é‡Œï¼Œè¿›ä¸€æ­¥è¯´æ˜è¯·æ±‚ä¿¡æ¯æˆ–è€…é¢å¤–çš„é™„åŠ æ¡ä»¶ï¼›ï¼ˆHostï¼ŒUser-Agentï¼‰
3. å“åº”å­—æ®µï¼šä»…èƒ½å‡ºç°åœ¨å“åº”å¤´é‡Œï¼Œè¡¥å……è¯´æ˜å“åº”æŠ¥æ–‡çš„ä¿¡æ¯ï¼›ï¼ˆServerï¼‰
4. å®ä½“å­—æ®µï¼šå®ƒå®é™…ä¸Šå±äºé€šç”¨å­—æ®µï¼Œä½†ä¸“é—¨æè¿° body çš„é¢å¤–ä¿¡æ¯ã€‚ï¼ˆContent-Lengthï¼‰

#### å°ç»“

1. HTTP æŠ¥æ–‡ç»“æ„å°±åƒæ˜¯â€œå¤§å¤´å„¿å­â€ï¼Œç”±â€œèµ·å§‹è¡Œ + å¤´éƒ¨ + ç©ºè¡Œ + å®ä½“â€ç»„æˆï¼Œç®€å•åœ°è¯´å°±æ˜¯â€œheader+bodyâ€ï¼›
2. HTTP æŠ¥æ–‡å¯ä»¥æ²¡æœ‰ bodyï¼Œä½†å¿…é¡»è¦æœ‰ headerï¼Œè€Œä¸” header åä¹Ÿå¿…é¡»è¦æœ‰ç©ºè¡Œï¼Œå½¢è±¡åœ°è¯´å°±æ˜¯â€œå¤§å¤´â€å¿…é¡»è¦å¸¦ç€â€œè„–å­â€ï¼›
3. è¯·æ±‚å¤´ç”±â€œè¯·æ±‚è¡Œ + å¤´éƒ¨å­—æ®µâ€æ„æˆï¼Œå“åº”å¤´ç”±â€œçŠ¶æ€è¡Œ + å¤´éƒ¨å­—æ®µâ€æ„æˆï¼›
4. è¯·æ±‚è¡Œæœ‰ä¸‰éƒ¨åˆ†ï¼šè¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚ç›®æ ‡å’Œç‰ˆæœ¬å·ï¼›çŠ¶æ€è¡Œä¹Ÿæœ‰ä¸‰éƒ¨åˆ†ï¼šç‰ˆæœ¬å·ï¼ŒçŠ¶æ€ç å’ŒåŸå› å­—ç¬¦ä¸²ï¼›
5. å¤´éƒ¨å­—æ®µæ˜¯ key-value çš„å½¢å¼ï¼Œç”¨â€œ:â€åˆ†éš”ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œé¡ºåºä»»æ„ï¼Œé™¤äº†è§„å®šçš„æ ‡å‡†å¤´ï¼Œä¹Ÿå¯ä»¥ä»»æ„æ·»åŠ è‡ªå®šä¹‰å­—æ®µï¼Œå®ç°åŠŸèƒ½æ‰©å±•ï¼›
6. HTTP/1.1 é‡Œå”¯ä¸€è¦æ±‚å¿…é¡»æä¾›çš„å¤´å­—æ®µæ˜¯ Hostï¼Œå®ƒå¿…é¡»å‡ºç°åœ¨è¯·æ±‚å¤´é‡Œï¼Œæ ‡è®°è™šæ‹Ÿä¸»æœºåã€‚

#### è¯¾ä¸‹ä½œä¸š

1. å¦‚æœæ‹¼ HTTP æŠ¥æ–‡çš„æ—¶å€™ï¼Œåœ¨å¤´å­—æ®µåå¤šåŠ äº†ä¸€ä¸ª CRLFï¼Œå¯¼è‡´å‡ºç°äº†ä¸€ä¸ªç©ºè¡Œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
2. è®²å¤´å­—æ®µæ—¶è¯´â€œ:â€åçš„ç©ºæ ¼å¯ä»¥æœ‰å¤šä¸ªï¼Œé‚£ä¸ºä»€ä¹ˆç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½åªä½¿ç”¨ä¸€ä¸ªç©ºæ ¼å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. å¤´å­—æ®µä¸‹é¢çš„ç©ºè¡Œä»¥åéƒ½ä¼šè¢«å½“åšbodyã€‚
2. èŠ‚çœèµ„æºã€‚

### 10ï½œåº”è¯¥å¦‚ä½•ç†è§£è¯·æ±‚æ–¹æ³•ï¼Ÿ

#### æ ‡å‡†è¯·æ±‚æ–¹æ³•

* ç›®å‰ HTTP/1.1 è§„å®šäº†å…«ç§æ–¹æ³•ï¼Œå•è¯éƒ½å¿…é¡»æ˜¯å¤§å†™çš„å½¢å¼

1. GETï¼šè·å–èµ„æºï¼Œå¯ä»¥ç†è§£ä¸ºè¯»å–æˆ–è€…ä¸‹è½½æ•°æ®ï¼›
2. HEADï¼šè·å–èµ„æºçš„å…ƒä¿¡æ¯ï¼ˆGETçš„ç®€åŒ–ç‰ˆï¼ŒæœåŠ¡å™¨åªä¼šè¿”å›å“åº”å¤´ï¼Œæ²¡æœ‰å“åº”ä½“ã€‚ï¼‰ï¼›
3. POSTï¼šå‘èµ„æºæäº¤æ•°æ®ï¼Œç›¸å½“äºå†™å…¥æˆ–ä¸Šä¼ æ•°æ®ï¼›
4. PUTï¼šç±»ä¼¼ POSTï¼Œæœ‰å¾®å¦™çš„ä¸åŒï¼ŒPOSTç±»ä¼¼â€œcreateâ€ï¼ŒPUTç±»ä¼¼â€œupdateâ€ï¼›
5. DELETEï¼šåˆ é™¤èµ„æºï¼›
6. CONNECTï¼šå»ºç«‹ç‰¹æ®Šçš„è¿æ¥éš§é“ï¼›
7. OPTIONSï¼šåˆ—å‡ºå¯å¯¹èµ„æºå®è¡Œçš„æ–¹æ³•ï¼›
8. TRACEï¼šè¿½è¸ªè¯·æ±‚ - å“åº”çš„ä¼ è¾“è·¯å¾„ã€‚

#### å°ç»“

1. è¯·æ±‚æ–¹æ³•æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„ã€è¦æ±‚æœåŠ¡å™¨æ‰§è¡Œçš„ã€å¯¹èµ„æºçš„ä¸€ç§æ“ä½œï¼›
2. è¯·æ±‚æ–¹æ³•æ˜¯å¯¹æœåŠ¡å™¨çš„â€œæŒ‡ç¤ºâ€ï¼ŒçœŸæ­£åº”å¦‚ä½•å¤„ç†ç”±æœåŠ¡å™¨æ¥å†³å®šï¼›
3. æœ€å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ GET å’Œ POSTï¼Œåˆ†åˆ«æ˜¯è·å–æ•°æ®å’Œå‘é€æ•°æ®ï¼›
4. HEAD æ–¹æ³•æ˜¯è½»é‡çº§çš„ GETï¼Œç”¨æ¥è·å–èµ„æºçš„å…ƒä¿¡æ¯ï¼›
5. PUT åŸºæœ¬ä¸Šæ˜¯ POST çš„åŒä¹‰è¯ï¼Œå¤šç”¨äºæ›´æ–°æ•°æ®ï¼›
6. â€œå®‰å…¨â€ä¸â€œå¹‚ç­‰â€æ˜¯æè¿°è¯·æ±‚æ–¹æ³•çš„ä¸¤ä¸ªé‡è¦å±æ€§ï¼Œå…·æœ‰ç†è®ºæŒ‡å¯¼æ„ä¹‰ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¾è®¡ç³»ç»Ÿã€‚

#### è¯¾ä¸‹ä½œä¸š

1. ä½ èƒ½æŠŠ GET/POST ç­‰è¯·æ±‚æ–¹æ³•å¯¹åº”åˆ°æ•°æ®åº“çš„â€œå¢åˆ æ”¹æŸ¥â€æ“ä½œå—ï¼Ÿè¯·æ±‚å¤´åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ
2. ä½ è§‰å¾— TRACE/OPTIONS/CONNECT æ–¹æ³•èƒ½å¤Ÿç”¨ GET æˆ– POST é—´æ¥å®ç°å—ï¼Ÿ

#### ä½œä¸šå›ç­”

1. å¢ï¼šPOST åˆ ï¼šDELETE æ”¹ï¼šPUT æŸ¥ï¼šGET
2. å¯ä»¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é‡æ–°å®šä¹‰æ“ä½œå¤´å­—æ®µã€‚

### 11ï½œä½ èƒ½å†™å‡ºæ­£ç¡®çš„ç½‘å€å—ï¼Ÿ

> URI æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²çš„ä½œç”¨æ˜¯å”¯ä¸€åœ°æ ‡è®°èµ„æºçš„ä½ç½®æˆ–è€…åå­—ã€‚è¿™é‡Œæˆ‘è¦æé†’ä½ æ³¨æ„ï¼Œå®ƒä¸ä»…èƒ½å¤Ÿæ ‡è®°ä¸‡ç»´ç½‘çš„èµ„æºï¼Œä¹Ÿå¯ä»¥æ ‡è®°å…¶ä»–çš„ï¼Œå¦‚é‚®ä»¶ç³»ç»Ÿã€æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç­‰ä»»æ„èµ„æºã€‚

#### URIçš„åŸºæœ¬ç»„æˆ

![URIçš„åŸºæœ¬ç»„æˆ](./img/uriçš„åŸºæœ¬ç»„æˆ.png)

* ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†åè®®åï¼Œç¬¬äºŒéƒ¨åˆ†ä¸»æœºåï¼ˆfileåè®®çœç•¥äº†ä¸»æœºåï¼Œé»˜è®¤æ˜¯æœ¬åœ°çš„ï¼‰+è·¯å¾„ï¼Œç¬¬ä¸‰éƒ¨åˆ†æŸ¥è¯¢å‚æ•°ã€‚
* ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†ä¹‹é—´ç”¨â€œ://â€åˆ†å‰²
* ç¬¬äºŒéƒ¨åˆ†å’Œç¬¬ä¸‰éƒ¨åˆ†ä¹‹é—´ç”¨â€œ?â€åˆ†å‰²

~~~java
http://nginx.org
http://www.chrono.com:8080/11-1
http://www.chrono.com:8080/11-1?uid=1234&name=mario
file:///D:/http_study/www/
~~~

#### åè®®åï¼ˆschemeï¼‰

* è¡¨ç¤ºèµ„æºä½¿ç”¨å“ªç§åè®®æ¥è®¿é—®ï¼Œå¸¸è§çš„åè®®æœ‰ï¼šhttpã€ftpã€ldapã€file

#### ä¸»æœº+è·¯å¾„

* åœ¨â€œ://â€ä¹‹åï¼Œæ˜¯èµ„æºæ‰€åœ¨çš„ä¸»æœºåï¼Œé€šå¸¸æ˜¯ipæˆ–åŸŸååŠ ç«¯å£å·ï¼Œåé¢çš„pathè¡¨ç¤ºèµ„æºå­ç›®å½•ã€‚

#### æŸ¥è¯¢å‚æ•°

* åœ¨â€œ?â€ä¹‹åï¼Œä½¿ç”¨â€œkey=valueâ€çš„å½¢å¼ï¼Œå¤šä¸ªé”®å€¼å¯¹ä¹‹é—´ä½¿ç”¨â€œ&â€è¿æ¥ã€‚

#### URIçš„ç¼–ç 

* URIé‡Œåªèƒ½ä½¿ç”¨ASCIIç ï¼Œå¦‚æœæœ‰ä¸­æ–‡è·å…¶ä»–ç‰¹æ®Šå­—ç¬¦éœ€è¦è¿›è¡Œè½¬ä¹‰ç¼–ç ï¼›
* ç¼–ç çš„æ–¹å¼ï¼ŒæŠŠå­—ç¬¦è½¬æ¢æˆåå…­è¿›åˆ¶å­—èŠ‚å€¼ï¼Œç„¶åå‰é¢åŠ ä¸Šâ€œ%â€ï¼›

> è¿™é‡Œçš„â€œå¤¸çˆ¶é€æ—¥â€æ˜¯key,çœç•¥äº†valueã€‚

```java
http://www.chrono.com:8080/11-1?å¤¸çˆ¶é€æ—¥
http://www.chrono.com:8080/11-1?%E5%A4%B8%E7%88%B6%E9%80%90%E6%97%A5
```

#### è¯¾ä¸‹ä½œä¸š

1. HTTP åè®®å…è®¸åœ¨åœ¨è¯·æ±‚è¡Œé‡Œä½¿ç”¨å®Œæ•´çš„ URIï¼Œä½†ä¸ºä»€ä¹ˆæµè§ˆå™¨æ²¡æœ‰è¿™ä¹ˆåšå‘¢ï¼Ÿ
2. URI çš„æŸ¥è¯¢å‚æ•°å’Œå¤´å­—æ®µå¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯ key-value å½¢å¼ï¼Œéƒ½å¯ä»¥ä»»æ„è‡ªå®šä¹‰ï¼Œé‚£ä¹ˆå®ƒä»¬åœ¨ä½¿ç”¨æ—¶è¯¥å¦‚ä½•åŒºåˆ«å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. å› ä¸ºè¯·æ±‚å¤´é‡Œé¢å·²ç»æœ‰äº†ä¸»æœºåï¼Œæ‰€ä»¥è¯·æ±‚è¡Œé‡Œï¼Œåªéœ€è¦æ·»åŠ è·¯å¾„ã€‚

   ```java
   GET /11-1 HTTP/1.1
   Host: www.chrono.com:8080
   ```

2. ä¸ªäººç†è§£ï¼Œqueryå‚æ•°é’ˆå¯¹çš„æ˜¯èµ„æºï¼ˆuriï¼‰ï¼Œè€Œå­—æ®µé’ˆå¯¹çš„æ˜¯æœ¬æ¬¡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æŠ¥æ–‡ã€‚ä¸€ä¸ªæ˜¯é•¿æœŸã€ç¨³å®šçš„ï¼Œä¸€ä¸ªæ˜¯çŸ­æœŸã€ä¸´æ—¶çš„ã€‚

### 12ï½œå“åº”çŠ¶æ€ç è¯¥æ€ä¹ˆç”¨ï¼Ÿ

#### çŠ¶æ€ç ç§ç±»

* 1Ã—Ã—ï¼šæç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºç›®å‰æ˜¯åè®®å¤„ç†çš„ä¸­é—´çŠ¶æ€ï¼Œè¿˜éœ€è¦åç»­çš„æ“ä½œï¼›
* 2Ã—Ã—ï¼šæˆåŠŸï¼ŒæŠ¥æ–‡å·²ç»æ”¶åˆ°å¹¶è¢«æ­£ç¡®å¤„ç†ï¼›
* 3Ã—Ã—ï¼šé‡å®šå‘ï¼Œèµ„æºä½ç½®å‘ç”Ÿå˜åŠ¨ï¼Œéœ€è¦å®¢æˆ·ç«¯é‡æ–°å‘é€è¯·æ±‚ï¼›
* 4Ã—Ã—ï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚æŠ¥æ–‡æœ‰è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼›
* 5Ã—Ã—ï¼šæœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯ã€‚

#### å°ç»“

1. çŠ¶æ€ç åœ¨å“åº”æŠ¥æ–‡é‡Œè¡¨ç¤ºäº†æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å¤„ç†ç»“æœï¼›
2. çŠ¶æ€ç åçš„åŸå› çŸ­è¯­æ˜¯ç®€å•çš„æ–‡å­—æè¿°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼›
3. çŠ¶æ€ç æ˜¯åè¿›åˆ¶çš„ä¸‰ä½æ•°ï¼Œåˆ†ä¸ºäº”ç±»ï¼Œä» 100 åˆ° 599ï¼›
4. 2Ã—Ã—ç±»çŠ¶æ€ç è¡¨ç¤ºæˆåŠŸï¼Œå¸¸ç”¨çš„æœ‰ 200ã€204ã€206ï¼›
5. 3Ã—Ã—ç±»çŠ¶æ€ç è¡¨ç¤ºé‡å®šå‘ï¼Œå¸¸ç”¨çš„æœ‰ 301ã€302ã€304ï¼›
6. 4Ã—Ã—ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ï¼Œå¸¸ç”¨çš„æœ‰ 400ã€403ã€404ï¼›
7. 5Ã—Ã—ç±»çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨é”™è¯¯ï¼Œå¸¸ç”¨çš„æœ‰ 500ã€501ã€502ã€503ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. ä½ åœ¨å¼€å‘ HTTP å®¢æˆ·ç«¯ï¼Œæ”¶åˆ°äº†ä¸€ä¸ªéæ ‡å‡†çš„çŠ¶æ€ç ï¼Œæ¯”å¦‚ 4Ã—Ã—ã€5Ã—Ã—ï¼Œåº”å½“å¦‚ä½•åº”å¯¹å‘¢ï¼Ÿ
2. ä½ åœ¨å¼€å‘ HTTP æœåŠ¡å™¨ï¼Œå¤„ç†è¯·æ±‚æ—¶å‘ç°æŠ¥æ–‡é‡Œç¼ºäº†ä¸€ä¸ªå¿…éœ€çš„ query å‚æ•°ï¼Œåº”è¯¥å¦‚ä½•å‘ŠçŸ¥å®¢æˆ·ç«¯é”™è¯¯åŸå› å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. ç»Ÿä¸€å½“æˆé”™è¯¯å¤„ç†ã€‚
2. é€šè¿‡å“åº”ä½“é‡Œçš„ä¸šåŠ¡ä¿¡æ¯å­—æ®µï¼Œæç¤ºå‚æ•°é”™è¯¯ä¿¡æ¯ã€‚

### 13ï½œHTTPæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ

#### Â å°ç»“

1. HTTP æ˜¯çµæ´»å¯æ‰©å±•çš„ï¼Œå¯ä»¥ä»»æ„æ·»åŠ å¤´å­—æ®µå®ç°ä»»æ„åŠŸèƒ½ï¼›
2. HTTP æ˜¯å¯é ä¼ è¾“åè®®ï¼ŒåŸºäº TCP/IP åè®®â€œå°½é‡â€ä¿è¯æ•°æ®çš„é€è¾¾ï¼›
3. HTTP æ˜¯åº”ç”¨å±‚åè®®ï¼Œæ¯” FTPã€SSH ç­‰æ›´é€šç”¨åŠŸèƒ½æ›´å¤šï¼Œèƒ½å¤Ÿä¼ è¾“ä»»æ„æ•°æ®ï¼›
4. HTTP ä½¿ç”¨äº†è¯·æ±‚ - åº”ç­”æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¢«åŠ¨å›å¤è¯·æ±‚ï¼›
5. HTTP æœ¬è´¨ä¸Šæ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹ã€æ¯«æ— å…³è”çš„ï¼Œåè®®ä¸è¦æ±‚å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨è®°å½•è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. å°±å¦‚åŒå¼€å¤´æˆ‘è®²çš„é‚£æ ·ï¼Œä½ èƒ½è¯´ä¸€ä¸‹ä»Šå¤©åˆ—å‡ºçš„è¿™äº› HTTP çš„ç‰¹ç‚¹ä¸­å“ªäº›æ˜¯ä¼˜ç‚¹ï¼Œå“ªäº›æ˜¯ç¼ºç‚¹å—ï¼Ÿ
2. ä¸åŒçš„åº”ç”¨åœºåˆæœ‰ä¸åŒçš„ä¾§é‡æ–¹é¢ï¼Œä½ è§‰å¾—å“ªä¸ªç‰¹ç‚¹å¯¹ä½ æ¥è¯´æ˜¯æœ€é‡è¦çš„å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. åº”è¯¥æ¥è¯´éƒ½æ˜¯ä¼˜ç‚¹ï¼Œå› ä¸ºéƒ½æ˜¯ä¸ºäº†å®ç°æŸç§åŠŸèƒ½è€Œå­˜åœ¨ï¼Œç¼ºç‚¹å°±æ˜¯è¿™äº›ä¹Ÿå¹¶ä¸æ˜¯ç»å¯¹å®Œç¾çš„ã€‚
2. çµæ´»å¯æ‹“å±•ã€‚

### 14ï½œHTTPæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿåˆæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ

#### å°ç»“

1. HTTP æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ç®€å•ã€çµæ´»å’Œæ˜“äºæ‰©å±•ï¼›
2. HTTP æ‹¥æœ‰æˆç†Ÿçš„è½¯ç¡¬ä»¶ç¯å¢ƒï¼Œåº”ç”¨çš„éå¸¸å¹¿æ³›ï¼Œæ˜¯äº’è”ç½‘çš„åŸºç¡€è®¾æ–½ï¼›
3. HTTP æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥è½»æ¾å®ç°é›†ç¾¤åŒ–ï¼Œæ‰©å±•æ€§èƒ½ï¼Œä½†æœ‰æ—¶ä¹Ÿéœ€è¦ç”¨ Cookie æŠ€æœ¯æ¥å®ç°â€œæœ‰çŠ¶æ€â€ï¼›
4. HTTP æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œæ•°æ®å®Œå…¨è‚‰çœ¼å¯è§ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°ç ”ç©¶åˆ†æï¼Œä½†ä¹Ÿå®¹æ˜“è¢«çªƒå¬ï¼›
5. HTTP æ˜¯ä¸å®‰å…¨çš„ï¼Œæ— æ³•éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½ï¼Œä¹Ÿä¸èƒ½åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦è¢«çªœæ”¹ï¼›
6. HTTP çš„æ€§èƒ½ä¸ç®—å·®ï¼Œä½†ä¸å®Œå…¨é€‚åº”ç°åœ¨çš„äº’è”ç½‘ï¼Œè¿˜æœ‰å¾ˆå¤§çš„æå‡ç©ºé—´ã€‚

### 15ï½œæµ·çº³ç™¾å·ï¼šHTTPçš„å®ä½“æ•°æ®

#### æ•°æ®ç±»å‹ä¸ç¼–ç 

* HTTPçš„æ•°æ®ç±»å‹å®šä¹‰æ˜¯ä»MIMEåè®®ï¼ˆâ€œå¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•â€ï¼ˆMultipurpose Internet Mail Extensionsï¼‰ï¼‰é‡Œå€Ÿé‰´çš„ã€‚ä½¿ç”¨â€œtype/subtypeâ€æ–¹å¼è¡¨ç¤ºã€‚å¸¸ç”¨çš„å‡ ç§å¦‚ä¸‹ï¼š

1. textï¼šå³æ–‡æœ¬æ ¼å¼çš„å¯è¯»æ•°æ®ï¼Œæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„åº”è¯¥å°±æ˜¯ text/html äº†ï¼Œè¡¨ç¤ºè¶…æ–‡æœ¬æ–‡æ¡£ï¼Œæ­¤å¤–è¿˜æœ‰çº¯æ–‡æœ¬ text/plainã€æ ·å¼è¡¨ text/css ç­‰ã€‚
2. imageï¼šå³å›¾åƒæ–‡ä»¶ï¼Œæœ‰ image/gifã€image/jpegã€image/png ç­‰ã€‚
3. audio/videoï¼šéŸ³é¢‘å’Œè§†é¢‘æ•°æ®ï¼Œä¾‹å¦‚ audio/mpegã€video/mp4 ç­‰ã€‚
4. applicationï¼šæ•°æ®æ ¼å¼ä¸å›ºå®šï¼Œå¯èƒ½æ˜¯æ–‡æœ¬ä¹Ÿå¯èƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¿…é¡»ç”±ä¸Šå±‚åº”ç”¨ç¨‹åºæ¥è§£é‡Šã€‚å¸¸è§çš„æœ‰ application/jsonï¼Œapplication/javascriptã€application/pdf ç­‰ï¼Œå¦å¤–ï¼Œå¦‚æœå®åœ¨æ˜¯ä¸çŸ¥é“æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåƒåˆšæ‰è¯´çš„â€œé»‘ç›’â€ï¼Œå°±ä¼šæ˜¯ application/octet-streamï¼Œå³ä¸é€æ˜çš„äºŒè¿›åˆ¶æ•°æ®ã€‚

* HTTPåœ¨ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼Œä¸ºäº†èŠ‚çº¦å®½å¸¦ï¼Œæœ‰æ—¶ä¼šå‹ç¼©æ•°æ®ï¼Œæ‰€ä»¥ä¼šæœ‰å‹ç¼©ç±»å‹â€œEncoding typeâ€ã€‚å¸¸ç”¨çš„ä»¥ä¸‹å‡ ç§ï¼š

1. gzipï¼šGNU zip å‹ç¼©æ ¼å¼ï¼Œä¹Ÿæ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„å‹ç¼©æ ¼å¼ï¼›
2. deflateï¼šzlibï¼ˆdeflateï¼‰å‹ç¼©æ ¼å¼ï¼Œæµè¡Œç¨‹åº¦ä»…æ¬¡äº gzipï¼›
3. brï¼šä¸€ç§ä¸“é—¨ä¸º HTTP ä¼˜åŒ–çš„æ–°å‹ç¼©ç®—æ³•ï¼ˆBrotliï¼‰ã€‚

![HTTPæ•°æ®ç±»å‹å’Œç¼–ç ](./img/httpæ•°æ®ç±»å‹å’Œç¼–ç .png)

### è¯­è¨€ç±»å‹å’Œç¼–ç 

* å¦‚æœè¯´æ•°æ®ç±»å‹å’Œç¼–ç å·²ç»è§£å†³äº†æ–‡ä»¶ä¼ è¾“é—®é¢˜ï¼Œé‚£è¿˜æœ‰ä¸€ä¸ªæ–‡æœ¬è¯»å–è§£æçš„é—®é¢˜ï¼Œæ¶‰åŠåˆ°å­—ç¬¦é›†ã€‚è¯­è¨€ç±»å‹ä½¿ç”¨â€œtype-subtypeâ€ï¼Œä¾‹å­ï¼šen è¡¨ç¤ºä»»æ„çš„è‹±è¯­ï¼Œen-US è¡¨ç¤ºç¾å¼è‹±è¯­ï¼Œen-GB è¡¨ç¤ºè‹±å¼è‹±è¯­ï¼Œè€Œ zh-CN å°±è¡¨ç¤ºæˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ±‰è¯­ã€‚

~~~java
Accept-Language: zh-CN, zh, en
Content-Language: zh-CN
~~~

* ç¼–ç æ–¹å¼ï¼Œæ²¡æœ‰ä½¿ç”¨å•ç‹¬å­—æ®µï¼Œè¿½åŠ åœ¨Content-Typeå­—æ®µåé¢ï¼Œä½¿ç”¨â€œcharset=xxxâ€æ¥è¡¨ç¤ºã€‚

~~~java
Accept-Charset: gbk, utf-8
Content-Type: text/html; charset=utf-8
~~~

![httpè¯­è¨€ç±»å‹å’Œç¼–ç ](./img/httpè¯­è¨€ç±»å‹å’Œç¼–ç .png)

#### å†…å®¹åå•†çš„è´¨é‡å€¼ï¼ˆæƒé‡ï¼‰

> åœ¨ HTTP åè®®é‡Œç”¨ Acceptã€Accept-Encodingã€Accept-Language ç­‰è¯·æ±‚å¤´å­—æ®µè¿›è¡Œå†…å®¹åå•†çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ç”¨ä¸€ç§ç‰¹æ®Šçš„â€œqâ€å‚æ•°è¡¨ç¤ºæƒé‡æ¥è®¾å®šä¼˜å…ˆçº§ï¼Œè¿™é‡Œçš„â€œqâ€æ˜¯â€œquality factorâ€çš„æ„æ€ã€‚æƒé‡çš„æœ€å¤§å€¼æ˜¯ 1ï¼Œæœ€å°å€¼æ˜¯ 0.01ï¼Œé»˜è®¤å€¼æ˜¯ 1ï¼Œå¦‚æœå€¼æ˜¯ 0 å°±è¡¨ç¤ºæ‹’ç»ã€‚å…·ä½“çš„å½¢å¼æ˜¯åœ¨æ•°æ®ç±»å‹æˆ–è¯­è¨€ä»£ç åé¢åŠ ä¸€ä¸ªâ€œ;â€ï¼Œç„¶åæ˜¯â€œq=valueâ€ã€‚

~~~java
Accept: text/html,application/xml;q=0.9,*/*;q=0.8
~~~

> å®ƒè¡¨ç¤ºæµè§ˆå™¨æœ€å¸Œæœ›ä½¿ç”¨çš„æ˜¯ HTML æ–‡ä»¶ï¼Œæƒé‡æ˜¯ 1ï¼Œå…¶æ¬¡æ˜¯ XML æ–‡ä»¶ï¼Œæƒé‡æ˜¯ 0.9ï¼Œæœ€åæ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œæƒé‡æ˜¯ 0.8ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚å¤´åï¼Œå°±ä¼šè®¡ç®—æƒé‡ï¼Œå†æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µä¼˜å…ˆè¾“å‡º HTML æˆ–è€… XMLã€‚

#### å†…å®¹åå•†çš„ç»“æœ

~~~java
Vary: Accept-Encoding,User-Agent,Accept
~~~

> è¿™ä¸ª Vary å­—æ®µè¡¨ç¤ºæœåŠ¡å™¨ä¾æ®äº† Accept-Encodingã€User-Agent å’Œ Accept è¿™ä¸‰ä¸ªå¤´å­—æ®µï¼Œç„¶åå†³å®šäº†å‘å›çš„å“åº”æŠ¥æ–‡ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. è¯•ç€è§£é‡Šä¸€ä¸‹è¿™ä¸ªè¯·æ±‚å¤´â€œAccept-Encoding: gzip, deflate;q=1.0, *;q=0.5, br;q=0â€ï¼Œå†æ¨¡æ‹Ÿä¸€ä¸‹æœåŠ¡å™¨çš„å“åº”å¤´ã€‚
2. å‡è®¾ä½ è¦ä½¿ç”¨ POST æ–¹æ³•å‘æœåŠ¡å™¨æäº¤ä¸€äº› JSON æ ¼å¼çš„æ•°æ®ï¼Œé‡Œé¢åŒ…å«æœ‰ä¸­æ–‡ï¼Œè¯·æ±‚å¤´åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ
3. è¯•ç€ç”¨å¿«é€’å‘è´§æ”¶è´§æ¯”å–»ä¸€ä¸‹ MIMEã€Encoding ç­‰æ¦‚å¿µ

#### ä½œä¸šå›ç­”

1. å®¢æˆ·ç«¯æ¥å—çš„ç¼–ç æ–¹å¼ï¼ŒæŒ‰ç…§æƒé‡æ¯”ä¾‹ä¼˜å…ˆçº§ä¾æ¬¡æ˜¯ï¼šgzipã€deflateã€ä»»æ„ã€brã€‚æœåŠ¡å™¨çš„å“åº”å¤´å¯èƒ½æ˜¯ï¼šContent-Encoding: gzipï¼›
2. æäº¤jsonæ ¼å¼æ•°æ®ï¼Œè¯·æ±‚å¤´é‡Œåº”è¯¥å«æœ‰å­—æ®µï¼šContent-Type:application/jsonã€‚
3. å¿«é€’å‘è´§ï¼Œç‰©å“ç±»å‹ä»£è¡¨MIMEï¼Œç”¨ç›’å­åŒ…è£…å¿«é€’ä»£è¡¨Encodingã€‚

### 16ï½œæŠŠå¤§è±¡è£…è¿›å†°ç®±ï¼šHTTPä¼ è¾“å¤§æ–‡ä»¶çš„æ–¹æ³•

#### åˆ†å—ä¼ è¾“

* æœåŠ¡å™¨å°†æ–‡ä»¶åˆ†å—ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œåœ¨å“åº”æŠ¥æ–‡é‡Œç”¨å¤´å­—æ®µâ€œTransfer-Encoding: chunkedâ€æ¥è¡¨ç¤ºï¼Œæ„æ€æ˜¯æŠ¥æ–‡é‡Œçš„ body éƒ¨åˆ†ä¸æ˜¯ä¸€æ¬¡æ€§å‘è¿‡æ¥çš„ï¼Œè€Œæ˜¯åˆ†æˆäº†è®¸å¤šçš„å—ï¼ˆchunkï¼‰é€ä¸ªå‘é€ã€‚

> â€œTransfer-Encoding: chunkedâ€å’Œâ€œContent-Lengthâ€è¿™ä¸¤ä¸ªå­—æ®µæ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å“åº”æŠ¥æ–‡é‡Œè¿™ä¸¤ä¸ªå­—æ®µä¸èƒ½åŒæ—¶å‡ºç°ï¼Œä¸€ä¸ªå“åº”æŠ¥æ–‡çš„ä¼ è¾“è¦ä¹ˆæ˜¯é•¿åº¦å·²çŸ¥ï¼Œè¦ä¹ˆæ˜¯é•¿åº¦æœªçŸ¥ï¼ˆchunkedï¼‰ï¼Œè¿™ä¸€ç‚¹ä½ ä¸€å®šè¦è®°ä½ã€‚

![httpåˆ†å—ä¼ è¾“](./img/httpåˆ†å—ä¼ è¾“.png)

![httpåˆ†å—ä¼ è¾“](./img/httpåˆ†å—ä¼ è¾“ç¤ºä¾‹1.png)

#### èŒƒå›´è¯·æ±‚

* â€œèŒƒå›´è¯·æ±‚â€ï¼ˆrange requests),å…è®¸å®¢æˆ·ç«¯è¯·æ±‚æŸä¸€éƒ¨åˆ†çš„æ–‡ä»¶è·å–ã€‚

> èŒƒå›´è¯·æ±‚ä¸æ˜¯ Web æœåŠ¡å™¨å¿…å¤‡çš„åŠŸèƒ½ï¼Œå¯ä»¥å®ç°ä¹Ÿå¯ä»¥ä¸å®ç°ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¿…é¡»åœ¨å“åº”å¤´é‡Œä½¿ç”¨å­—æ®µâ€œAccept-Ranges: bytesâ€æ˜ç¡®å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼šâ€œæˆ‘æ˜¯æ”¯æŒèŒƒå›´è¯·æ±‚çš„â€ã€‚å¦‚æœä¸æ”¯æŒçš„è¯è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸæœåŠ¡å™¨å¯ä»¥å‘é€â€œAccept-Ranges: noneâ€ï¼Œæˆ–è€…å¹²è„†ä¸å‘é€â€œAccept-Rangesâ€å­—æ®µï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±è®¤ä¸ºæœåŠ¡å™¨æ²¡æœ‰å®ç°èŒƒå›´è¯·æ±‚åŠŸèƒ½ï¼Œåªèƒ½è€è€å®å®åœ°æ”¶å‘æ•´å—æ–‡ä»¶äº†ã€‚

* è¯·æ±‚å¤´ Range æ˜¯ HTTP èŒƒå›´è¯·æ±‚çš„ä¸“ç”¨å­—æ®µï¼Œæ ¼å¼æ˜¯â€œbytes=x-yâ€ï¼Œå…¶ä¸­çš„ x å’Œ y æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„æ•°æ®èŒƒå›´ã€‚è¦æ³¨æ„ xã€y è¡¨ç¤ºçš„æ˜¯â€œåç§»é‡â€ï¼Œä¾‹å¦‚å‰ 10 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸ºâ€œ0-9â€ã€‚æœåŠ¡ç«¯è¿”å›å“åº”ç 206ï¼Œè¡¨ç¤ºæ˜¯åŸå§‹æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚

![httpèŒƒå›´ä¸‹è½½](./img/httpèŒƒå›´ä¸‹è½½ç¤ºä¾‹.png)

#### èŒƒå›´è¯·æ±‚ï¼ˆå¤šæ®µï¼‰

* è·ŸèŒƒå›´è¯·æ±‚ç±»ä¼¼ï¼Œåªæ˜¯ä¸€æ¬¡è¯·æ±‚å¤šä¸ªèŒƒå›´ã€‚MIME ç±»å‹ï¼šâ€œmultipart/byterangesâ€ï¼Œè¡¨ç¤ºæŠ¥æ–‡çš„ body æ˜¯ç”±å¤šæ®µå­—èŠ‚åºåˆ—ç»„æˆçš„ï¼Œå¹¶ä¸”è¿˜è¦ç”¨ä¸€ä¸ªå‚æ•°â€œboundary=xxxâ€ç»™å‡ºæ®µä¹‹é—´çš„åˆ†éš”æ ‡è®°ã€‚

![httpèŒƒå›´ä¸‹è½½2](./img/httpèŒƒå›´ä¸‹è½½ç¤ºä¾‹2.png)

#### è¯¾ä¸‹ä½œä¸š

1. åˆ†å—ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®é‡Œå«æœ‰å›è½¦æ¢è¡Œï¼ˆ\r\nï¼‰æ˜¯å¦ä¼šå½±å“åˆ†å—çš„å¤„ç†å‘¢ï¼Ÿ
2. å¦‚æœå¯¹ä¸€ä¸ªè¢« gzip çš„æ–‡ä»¶æ‰§è¡ŒèŒƒå›´è¯·æ±‚ï¼Œæ¯”å¦‚â€œRange: bytes=10-19â€ï¼Œé‚£ä¹ˆè¿™ä¸ªèŒƒå›´æ˜¯åº”ç”¨äºåŸæ–‡ä»¶è¿˜æ˜¯å‹ç¼©åçš„æ–‡ä»¶å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. ä¸å½±å“ï¼Œåˆ†å—ä¼ è¾“æ²¡å—æ•°æ®éƒ½æœ‰é•¿åº¦æ ‡ç¤ºã€‚
2. åº”ç”¨äºåŸæ–‡ä»¶ã€‚

### 17ï½œæ’é˜Ÿä¹Ÿè¦è®²æ•ˆç‡ï¼šHTTPçš„è¿æ¥ç®¡ç†

#### å°ç»“

1. æ—©æœŸçš„ HTTP åè®®ä½¿ç”¨çŸ­è¿æ¥ï¼Œæ”¶åˆ°å“åº”åå°±ç«‹å³å…³é—­è¿æ¥ï¼Œæ•ˆç‡å¾ˆä½ï¼›
2. HTTP/1.1 é»˜è®¤å¯ç”¨é•¿è¿æ¥ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸Šæ”¶å‘å¤šä¸ªè¯·æ±‚å“åº”ï¼Œæé«˜äº†ä¼ è¾“æ•ˆç‡ï¼›
3. æœåŠ¡å™¨ä¼šå‘é€â€œConnection: keep-aliveâ€å­—æ®µè¡¨ç¤ºå¯ç”¨äº†é•¿è¿æ¥ï¼›
4. æŠ¥æ–‡å¤´é‡Œå¦‚æœæœ‰â€œConnection: closeâ€å°±æ„å‘³ç€é•¿è¿æ¥å³å°†å…³é—­ï¼›
5. è¿‡å¤šçš„é•¿è¿æ¥ä¼šå ç”¨æœåŠ¡å™¨èµ„æºï¼Œæ‰€ä»¥æœåŠ¡å™¨ä¼šç”¨ä¸€äº›ç­–ç•¥æœ‰é€‰æ‹©åœ°å…³é—­é•¿è¿æ¥ï¼›
6. â€œé˜Ÿå¤´é˜»å¡â€é—®é¢˜ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå¯ä»¥ç”¨â€œå¹¶å‘è¿æ¥â€å’Œâ€œåŸŸååˆ†ç‰‡â€æŠ€æœ¯ç¼“è§£ã€‚

#### è¯¾ä¸‹ä½œä¸š

1. åœ¨å¼€å‘åŸºäº HTTP åè®®çš„å®¢æˆ·ç«¯æ—¶åº”è¯¥å¦‚ä½•é€‰æ‹©ä½¿ç”¨çš„è¿æ¥æ¨¡å¼å‘¢ï¼ŸçŸ­è¿æ¥è¿˜æ˜¯é•¿è¿æ¥ï¼Ÿ
2. åº”å½“å¦‚ä½•é™ä½é•¿è¿æ¥å¯¹æœåŠ¡å™¨çš„è´Ÿé¢å½±å“å‘¢ï¼Ÿ

#### ä½œä¸šå›ç­”

1. æ ¹æ®è¯·æ±‚çš„é¢‘ç¹ç¨‹åº¦æ¥é€‰æ‹©è¿æ¥æ¨¡å¼ã€‚ä¸€æ¬¡æ€§çš„è¯·æ±‚ç”¨çŸ­é“¾æ¥ï¼Œé¢‘ç¹ä¸æœåŠ¡ç«¯äº¤äº’çš„ç”¨é•¿è¿æ¥ã€‚
2. é•¿è¿æ¥ä¼šé•¿æœŸå ç”¨æœåŠ¡å™¨èµ„æºï¼Œæ ¹æ®æœåŠ¡å™¨æ€§èƒ½è®¾ç½®è¿æ¥æ•°å’Œé•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œä¿è¯æœåŠ¡å™¨TCPèµ„æºä½¿ç”¨å¤„äºæ­£å¸¸èŒƒå›´ã€‚

### 18ï½œå››é€šå…«è¾¾ï¼šHTTPçš„é‡å®šå‘å’Œè·³è½¬

#### å°ç»“

1. é‡å®šå‘æ˜¯æœåŠ¡å™¨å‘èµ·çš„è·³è½¬ï¼Œè¦æ±‚å®¢æˆ·ç«¯æ”¹ç”¨æ–°çš„ URI é‡æ–°å‘é€è¯·æ±‚ï¼Œé€šå¸¸ä¼šè‡ªåŠ¨è¿›è¡Œï¼Œç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ï¼›
2. 301/302 æ˜¯æœ€å¸¸ç”¨çš„é‡å®šå‘çŠ¶æ€ç ï¼Œåˆ†åˆ«æ˜¯â€œæ°¸ä¹…é‡å®šå‘â€å’Œâ€œä¸´æ—¶é‡å®šå‘â€ï¼›
3. å“åº”å¤´å­—æ®µ Location æŒ‡ç¤ºäº†è¦è·³è½¬çš„ URIï¼Œå¯ä»¥ç”¨ç»å¯¹æˆ–ç›¸å¯¹çš„å½¢å¼ï¼›
4. é‡å®šå‘å¯ä»¥æŠŠä¸€ä¸ª URI æŒ‡å‘å¦ä¸€ä¸ª URIï¼Œä¹Ÿå¯ä»¥æŠŠå¤šä¸ª URI æŒ‡å‘åŒä¸€ä¸ª URIï¼Œç”¨é€”å¾ˆå¤šï¼›
5. ä½¿ç”¨é‡å®šå‘æ—¶éœ€è¦å½“å¿ƒæ€§èƒ½æŸè€—ï¼Œè¿˜è¦é¿å…å‡ºç°å¾ªç¯è·³è½¬ã€‚

### 19ï½œè®©æˆ‘çŸ¥é“ä½ æ˜¯è°ï¼šHTTPçš„Cookieæœºåˆ¶

![httpCookie](./img/httpCookie.png)

#### å°ç»“

1. Cookie æ˜¯æœåŠ¡å™¨å§”æ‰˜æµè§ˆå™¨å­˜å‚¨çš„ä¸€äº›æ•°æ®ï¼Œè®©æœåŠ¡å™¨æœ‰äº†â€œè®°å¿†èƒ½åŠ›â€ï¼›
2. å“åº”æŠ¥æ–‡ä½¿ç”¨ Set-Cookie å­—æ®µå‘é€â€œkey=valueâ€å½¢å¼çš„ Cookie å€¼ï¼›
3. è¯·æ±‚æŠ¥æ–‡é‡Œç”¨ Cookie å­—æ®µå‘é€å¤šä¸ª Cookie å€¼ï¼›
4. ä¸ºäº†ä¿æŠ¤ Cookieï¼Œè¿˜è¦ç»™å®ƒè®¾ç½®æœ‰æ•ˆæœŸã€ä½œç”¨åŸŸç­‰å±æ€§ï¼Œå¸¸ç”¨çš„æœ‰ Max-Ageã€Expiresã€Domainã€HttpOnly ç­‰ï¼›
5. Cookie æœ€åŸºæœ¬çš„ç”¨é€”æ˜¯èº«ä»½è¯†åˆ«ï¼Œå®ç°æœ‰çŠ¶æ€çš„ä¼šè¯äº‹åŠ¡ã€‚

### 20ï½œç”Ÿé²œé€Ÿé€’ï¼šHTTPçš„ç¼“å­˜æ§åˆ¶

#### å°ç»“

1. ç¼“å­˜æ˜¯ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½çš„é‡è¦æ‰‹æ®µï¼ŒHTTP ä¼ è¾“çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¸­éƒ½å¯ä»¥æœ‰ç¼“å­˜ï¼›
2. æœåŠ¡å™¨ä½¿ç”¨â€œCache-Controlâ€è®¾ç½®ç¼“å­˜ç­–ç•¥ï¼Œå¸¸ç”¨çš„æ˜¯â€œmax-ageâ€ï¼Œè¡¨ç¤ºèµ„æºçš„æœ‰æ•ˆæœŸï¼›
3. æµè§ˆå™¨æ”¶åˆ°æ•°æ®å°±ä¼šå­˜å…¥ç¼“å­˜ï¼Œå¦‚æœæ²¡è¿‡æœŸå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿‡æœŸå°±è¦å»æœåŠ¡å™¨éªŒè¯æ˜¯å¦ä»ç„¶å¯ç”¨ï¼›
4. éªŒè¯èµ„æºæ˜¯å¦å¤±æ•ˆéœ€è¦ä½¿ç”¨â€œæ¡ä»¶è¯·æ±‚â€ï¼Œå¸¸ç”¨çš„æ˜¯â€œif-Modified-Sinceâ€å’Œâ€œIf-None-Matchâ€ï¼Œæ”¶åˆ° 304 å°±å¯ä»¥å¤ç”¨ç¼“å­˜é‡Œçš„èµ„æºï¼›
5. éªŒè¯èµ„æºæ˜¯å¦è¢«ä¿®æ”¹çš„æ¡ä»¶æœ‰ä¸¤ä¸ªï¼šâ€œLast-modifiedâ€å’Œâ€œETagâ€ï¼Œéœ€è¦æœåŠ¡å™¨é¢„å…ˆåœ¨å“åº”æŠ¥æ–‡é‡Œè®¾ç½®ï¼Œæ­é…æ¡ä»¶è¯·æ±‚ä½¿ç”¨ï¼›
6. æµè§ˆå™¨ä¹Ÿå¯ä»¥å‘é€â€œCache-Controlâ€å­—æ®µï¼Œä½¿ç”¨â€œmax-age=0â€æˆ–â€œno_cacheâ€åˆ·æ–°æ•°æ®ã€‚

#### 21ï½œè‰¯å¿ƒä¸­é—´å•†ï¼šHTTPçš„ä»£ç†æœåŠ¡

#### å°ç»“

1. HTTP ä»£ç†å°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šä¿¡é“¾è·¯ä¸­çš„ä¸€ä¸ªä¸­é—´ç¯èŠ‚ï¼Œä¸ºä¸¤ç«¯æä¾›â€œä»£ç†æœåŠ¡â€ï¼›
2. ä»£ç†å¤„äºä¸­é—´å±‚ï¼Œä¸º HTTP å¤„ç†å¢åŠ äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€å®‰å…¨é˜²æŠ¤ã€æ•°æ®è¿‡æ»¤ç­‰åŠŸèƒ½ï¼›
3. ä»£ç†æœåŠ¡å™¨éœ€è¦ä½¿ç”¨å­—æ®µâ€œViaâ€æ ‡è®°è‡ªå·±çš„èº«ä»½ï¼Œå¤šä¸ªä»£ç†ä¼šå½¢æˆä¸€ä¸ªåˆ—è¡¨ï¼›
4. å¦‚æœæƒ³è¦çŸ¥é“å®¢æˆ·ç«¯çš„çœŸå® IP åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨å­—æ®µâ€œX-Forwarded-Forâ€å’Œâ€œX-Real-IPâ€ï¼›
5. ä¸“é—¨çš„â€œä»£ç†åè®®â€å¯ä»¥åœ¨ä¸æ”¹åŠ¨åŸå§‹æŠ¥æ–‡çš„æƒ…å†µä¸‹ä¼ é€’å®¢æˆ·ç«¯çš„çœŸå® IPã€‚

### 23ï½œHTTPSæ˜¯ä»€ä¹ˆï¼ŸSSL/TLSåˆæ˜¯ä»€ä¹ˆï¼Ÿ

#### httpså’Œhttpçš„åŒºåˆ«

* åè®®åä¸åŒï¼Œä¸€ä¸ªæ˜¯httpsï¼Œä¸€ä¸ªæ˜¯httpã€‚
* ç«¯å£å·ä¸åŒï¼Œä¸€ä¸ªæ˜¯443ï¼Œä¸€ä¸ªæ˜¯80ã€‚
* å®‰å…¨æ€§ä¸åŒï¼Œä¸€ä¸ªæ˜¯åŠ å¯†ï¼Œä¸€ä¸ªæ˜¯æ˜æ–‡ã€‚

![httpå’Œhttps](./img/httpå’Œhttps.png)

#### SSL/TLS

* SSL å³å®‰å…¨å¥—æ¥å±‚ï¼ˆSecure Sockets Layerï¼‰ï¼Œåœ¨ OSI æ¨¡å‹ä¸­å¤„äºç¬¬ 5 å±‚ï¼ˆä¼šè¯å±‚ï¼‰ï¼Œå‘å±•åˆ°v3ç‰ˆæœ¬çš„æ—¶å€™æ”¹åä¸ºTLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼ŒTransport Layer Securityï¼‰ï¼Œæœ€å¹¿æ³›çš„ç‰ˆæœ¬ä¸ºTLS1.2ã€‚

#### é€šè®¯å®‰å…¨

* æœºå¯†æ€§ï¼šä¸èƒ½è¢«äººä¸€çœ¼å°±çœ‹æ‡‚äº†æ¶ˆæ¯ã€‚æ‰€ä»¥ä½¿ç”¨åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†æ˜æ–‡ã€‚
* å®Œæ•´æ€§ï¼šä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæ²¡æœ‰ç¼ºå¤±æˆ–è€…è¢«ä¿®æ”¹ã€‚
* èº«ä»½è®¤è¯ï¼šé€šè®¯åŒæ–¹çš„è®¤è¯ï¼Œé˜²æ­¢é»‘å®¢å†’å……å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯å’Œå¯¹æ–¹é€šè®¯ã€‚

#### OpenSSL

* ä¸€ä¸ªå¼€æºçš„å¯†ç å­¦ç¨‹åºåº“å’Œå·¥å…·åŒ…ï¼Œè®¸å¤šåº”ç”¨è½¯ä»¶ä½¿ç”¨å®ƒä½œä¸ºåº•å±‚åº“æ¥å®ç°TLSåŠŸèƒ½ã€‚

### 24ï½œå›ºè‹¥é‡‘æ±¤çš„æ ¹æœ¬ï¼ˆä¸Šï¼‰ï¼šå¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†

#### å¯¹ç§°åŠ å¯†

* AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†â€ï¼ˆAdvanced Encryption Standardï¼‰ï¼‰ï¼Œé•¿åº¦æœ‰ 128ã€192 æˆ– 256ã€‚
* ChaCha20æ˜¯ Google è®¾è®¡çš„å¦ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦å›ºå®šä¸º 256 ä½ã€‚

> å¯¹ç§°åŠ å¯†è¿˜è¦ç»“åˆä¸€ä¸ªâ€œåˆ†ç»„æ¨¡å¼â€ï¼ˆå°†æ˜æ–‡åˆ†ç»„ï¼‰ï¼Œæ‰æ˜¯å®Œæ•´çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚
>
> æ¯”å¦‚ï¼ŒAES128-GCMï¼Œæ„æ€æ˜¯å¯†é’¥é•¿åº¦ä¸º 128 ä½çš„ AES ç®—æ³•ï¼Œä½¿ç”¨çš„åˆ†ç»„æ¨¡å¼æ˜¯ GCMï¼›ChaCha20-Poly1305 çš„æ„æ€æ˜¯ ChaCha20 ç®—æ³•ï¼Œä½¿ç”¨çš„åˆ†ç»„æ¨¡å¼æ˜¯ Poly1305ã€‚

ç¼ºç‚¹ï¼šæ— æ³•æŠŠå¯†é’¥å®‰å…¨çš„ä¼ é€’ç»™å¯¹æ–¹ã€‚

#### éå¯¹ç§°åŠ å¯†

æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œä¸€ä¸ªå…¬é’¥ï¼Œä¸€ä¸ªç§é’¥ï¼Œå…¬é’¥åŠ å¯†åªèƒ½ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†åªèƒ½å…¬é’¥è§£å¯†ã€‚

* RSAï¼ˆå‘æ˜äººçš„åå­—é¦–å†™ï¼‰ï¼Œ1024ã€2048ï¼ŒåŸºäºâ€œæ•´æ•°åˆ†è§£â€çš„æ•°å­¦éš¾é¢˜ã€‚
* ECCï¼ˆElliptic Curve Cryptographyï¼‰ï¼Œ160ã€224ï¼ŒåŸºäºâ€œæ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°â€çš„æ•°å­¦éš¾é¢˜ã€‚

ç¼ºç‚¹ï¼šå› ä¸ºéƒ½æ˜¯åŸºäºå¤æ‚çš„æ•°å­¦éš¾é¢˜ï¼Œè¿ç®—é‡å¤§ï¼Œæ‰€ä»¥åŠ å¯†é€Ÿåº¦æ…¢ã€‚

#### æ··åˆåŠ å¯†

* ç»“åˆå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯TLSç›®å‰ä½¿ç”¨çš„æ··åˆåŠ å¯†æ–¹å¼ã€‚å…ˆä½¿ç”¨éå¯¹ç§°åŠ å¯†äº¤æ¢å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œåç»­ä½¿ç”¨å¯¹ç§°åŠ å¯†çš„å¯†é’¥é€šè®¯ã€‚

> HTTPS è¿æ¥å¤§è‡´ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæ˜¯å»ºç«‹è¿æ¥æ—¶çš„éå¯¹ç§°åŠ å¯†æ¡æ‰‹ï¼Œç¬¬äºŒä¸ªæ˜¯æ¡æ‰‹åçš„å¯¹ç§°åŠ å¯†æŠ¥æ–‡ä¼ è¾“ã€‚

### 25ï½œå›ºè‹¥é‡‘æ±¤çš„æ ¹æœ¬ï¼ˆä¸‹ï¼‰ï¼šæ•°å­—ç­¾åä¸è¯ä¹¦

#### æ‘˜è¦ç®—æ³•

ç»™æ•°æ®ç”Ÿæˆä¸€ä¸²â€œæ‘˜è¦â€å­—ç¬¦ä¸²ï¼Œä¸å¯é€†ã€‚å¸¸è¯´çš„æ•£åˆ—å‡½æ•°ã€å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰ã€‚

å¸¸ç”¨çš„æœ‰MD5ã€SHA-1ã€SHA-2ã€SHA256ã€‚

ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚

#### æ•°å­—ç­¾å

ä½¿ç”¨ç§é’¥åŠ å¯†â€œæ‘˜è¦â€ï¼Œè·å¾—æ•°å­—ç­¾åï¼Œä½¿ç”¨å…¬é’¥è§£å¯†æ•°å­—ç­¾åï¼Œè·å¾—â€œæ‘˜è¦â€ï¼Œå†æ¯”å¯¹åŸæ–‡çš„æ‘˜è¦ã€‚

> åˆšæ‰çš„è¿™ä¸¤ä¸ªè¡Œä¸ºä¹Ÿæœ‰ä¸“ç”¨æœ¯è¯­ï¼Œå«åšâ€œç­¾åâ€å’Œâ€œéªŒç­¾â€ã€‚åªè¦ä½ å’Œç½‘ç«™äº’ç›¸äº¤æ¢å…¬é’¥ï¼Œå°±å¯ä»¥ç”¨â€œç­¾åâ€å’Œâ€œéªŒç­¾â€æ¥ç¡®è®¤æ¶ˆæ¯çš„çœŸå®æ€§ï¼Œå› ä¸ºç§é’¥ä¿å¯†ï¼Œé»‘å®¢ä¸èƒ½ä¼ªé€ ç­¾åï¼Œå°±èƒ½å¤Ÿä¿è¯é€šä¿¡åŒæ–¹çš„èº«ä»½ã€‚

#### æ•°å­—è¯ä¹¦å’Œ CA

ç”±æƒå¨æœºæ„è®¤è¯çš„ï¼Œä¿è¯å…¬é’¥çš„å¯é æ€§ã€‚

### 26ï½œä¿¡ä»»å§‹äºæ¡æ‰‹ï¼šTLS1.2è¿æ¥è¿‡ç¨‹è§£æ

#### ç®€å›¾

![tlsæ¡æ‰‹æµç¨‹](./img/tlsç®€å›¾.png)

#### ECDHEæ¡æ‰‹è¿‡ç¨‹

![ecdheæ¡æ‰‹æµç¨‹](./img/ECDHEæ¡æ‰‹æµç¨‹.png)

#### æµç¨‹åˆ†æ

å…³é”®çš„æ˜¯4ä¸ªTCPåŒ…ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ä¸ªæ¥å›ã€‚

1. ç¬¬ä¸€ä¸ªåŒ…ï¼šå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯

   * â€œClient Helloâ€ï¼ˆç‰ˆæœ¬å·ã€éšæœºæ•°ï¼ˆClient Randomï¼‰ã€æ”¯æŒçš„å¯†ç å¥—ä»¶ï¼‰ã€‚

     ~~~java
     Handshake Protocol: Client Hello
         Version: TLS 1.2 (0x0303)
         Random: 1cbf803321fd2623408dfeâ€¦
         Cipher Suites (17 suites)
             Cipher Suite: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)
             Cipher Suite: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)
     ~~~

2. ç¬¬äºŒä¸ªåŒ…ï¼šæœåŠ¡ç«¯å›å¤å®¢æˆ·ç«¯

   * â€œServer Helloâ€ï¼ˆç‰ˆæœ¬å·ã€éšæœºæ•°ï¼ˆServer Randomï¼‰ã€é€‰æ‹©çš„å¯†ç å¥—ä»¶ï¼‰

     ~~~java
     Handshake Protocol: Server Hello
         Version: TLS 1.2 (0x0303)
         Random: 0e6320f21bae50842e96â€¦
         Cipher Suite: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)
     ~~~

   * â€œCertificateâ€ï¼ŒæœåŠ¡ç«¯æŠŠè¯ä¹¦å‘ç»™å®¢æˆ·ç«¯ã€‚

   * "Server Key Exchange"ï¼Œæ¤­åœ†æ›²çº¿çš„å…¬é’¥ï¼ˆServer Paramsï¼‰ï¼Œç§é’¥çš„ç­¾åã€‚

     ~~~java
     Handshake Protocol: Server Key Exchange
         EC Diffie-Hellman Server Params
             Curve Type: named_curve (0x03)
             Named Curve: x25519 (0x001d)
             Pubkey: 3b39deaf00217894e...
             Signature Algorithm: rsa_pkcs1_sha512 (0x0601)
             Signature: 37141adac38ea4...
     ~~~

   * "Server Hello Done"ï¼ŒæœåŠ¡ç«¯å›å¤ç»“æŸã€‚

3. ç¬¬ä¸‰ä¸ªåŒ…ï¼šå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯

   * â€œClient Key Exchangeâ€ï¼Œæ¤­åœ†æ›²çº¿çš„å…¬é’¥ï¼ˆClient Paramsï¼‰ã€‚

     ~~~java
     Handshake Protocol: Client Key Exchange
         EC Diffie-Hellman Client Params
             Pubkey: 8c674d0e08dc27b5eaaâ€¦
     ~~~

   * "Change Cipher Spec"ï¼ŒåŠ å¯†é€šä¿¡ç”Ÿæ•ˆã€‚

   * â€œEncrypted Handshake Messageâ€(ç»è¿‡åŠ å¯†çš„æ¶ˆæ¯)

4. ç¬¬å››ä¸ªåŒ…ï¼šæœåŠ¡ç«¯å›å¤å®¢æˆ·ç«¯

   * â€œChange Cipher Specâ€
   * â€œEncrypted Handshake Messageâ€(ç»è¿‡åŠ å¯†çš„æ¶ˆæ¯)

#### æœ€ç»ˆä¼šè¯å¯†é’¥çš„ç”Ÿæˆï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ†åˆ«é€šè¿‡ç®—æ³•ç”Ÿæˆï¼‰

1. ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šè¿‡ç®—æ³•ç”Ÿæˆçš„å…¬é’¥ï¼Œç”Ÿæˆâ€œPre-Masterâ€ã€‚
2. ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„éšæœºæ•°ï¼ŒåŠ ä¸Šâ€œPre-Master"ï¼Œç”Ÿæˆâ€œMaster Secretâ€ï¼Œç”¨äºä¼šè¯çš„ä¸»å¯†é’¥ã€‚

#### RSAæ¡æ‰‹è¿‡ç¨‹

åŒºåˆ«åœ¨äºPre-Masteræ˜¯ç”±å®¢æˆ·ç«¯ç›´æ¥ç”Ÿæˆçš„ä¸€ä¸ªéšæœºæ•°ã€‚

![RSAæ¡æ‰‹è¿‡ç¨‹](./img/RSAæ¡æ‰‹æµç¨‹.png)

#### ç®€å•å°ç»“ï¼ˆECDHEï¼‰

1. ç¬¬ä¸€æ­¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œç¡®è®¤åŠ å¯†ç®—æ³•ï¼Œäº¤æ¢éšæœºæ•°ï¼Œäº¤æ¢å…¬é’¥ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°æœåŠ¡ç«¯è¯ä¹¦å’Œæ•°å­—ç­¾åã€‚
2. ç¬¬äºŒæ­¥ï¼Œé€šè¿‡å…¬é’¥ç”Ÿæˆâ€œPre-Masterâ€ï¼Œé€šè¿‡éšæœºæ•°å’Œâ€œPre-Masterâ€ç”Ÿæˆæœ€ç»ˆä¼šè¯å¯†é’¥â€œMaster Secretâ€ã€‚

### 27ï½œæ›´å¥½æ›´å¿«çš„æ¡æ‰‹ï¼šTLS1.3ç‰¹æ€§è§£æ

#### ç®€å›¾

![tls1.3](./img/tls1.3ç®€å›¾.png)

#### æ¡æ‰‹æµç¨‹

![tls1.3æµç¨‹å›¾](./img/tls1.3æµç¨‹å›¾.png)

#### æµç¨‹åˆ†æ

> 1.3å¯¹æ¯”1.2ï¼Œç²¾ç®€äº†ç®—æ³•å¥—ä»¶ï¼Œç®€åŒ–äº†æ¡æ‰‹æµç¨‹ï¼ŒåŠ å¼ºäº†å®‰å…¨æ€§ã€‚é»˜è®¤ä½¿ç”¨ECDHEã€‚

1. ç¬¬ä¸€ä¸ªåŒ…ï¼šå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ï¼ˆå’Œ1.2æµç¨‹ç›¸æ¯”ï¼Œæ–°å¢äº†å¾ˆå¤šæ‹“å±•å­—æ®µï¼‰

   * â€œClient Helloâ€ï¼ˆç‰ˆæœ¬å·ã€éšæœºæ•°ï¼ˆClient Randomï¼‰ã€æ”¯æŒçš„å¯†ç å¥—ä»¶ï¼‰ã€‚

     ~~~java
     Handshake Protocol: Client Hello
         Version: TLS 1.2 (0x0303)
         Random: cebeb6c05403654d66c2329â€¦
         Cipher Suites (18 suites)
             Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)
             Cipher Suite: TLS_CHACHA20_POLY1305_SHA256 (0x1303)
             Cipher Suite: TLS_AES_256_GCM_SHA384 (0x1302)
         Extension: supported_versions (len=9)
             Supported Version: TLS 1.3 (0x0304)
             Supported Version: TLS 1.2 (0x0303)
         Extension: supported_groups (len=14)
             Supported Groups (6 groups)
                 Supported Group: x25519 (0x001d)
                 Supported Group: secp256r1 (0x0017)
         Extension: key_share (len=107)
             Key Share extension
                 Client Key Share Length: 105
                 Key Share Entry: Group: x25519
                 Key Share Entry: Group: secp256r1
     ~~~

     > æ³¨æ„â€œClient Helloâ€é‡Œçš„æ‰©å±•ï¼Œâ€œsupported_versionsâ€è¡¨ç¤ºè¿™æ˜¯TLS1.3ï¼Œâ€œsupported_groupsâ€æ˜¯æ”¯æŒçš„æ›²çº¿ï¼Œâ€œkey_shareâ€æ˜¯æ›²çº¿å¯¹åº”çš„å‚æ•°ã€‚

2. ç¬¬äºŒä¸ªåŒ…ï¼šæœåŠ¡ç«¯å›å¤å®¢æˆ·ç«¯ï¼ˆä¹Ÿæ˜¯å’Œ1.2ç±»ä¼¼çš„ï¼Œå¤šä¸€äº›æ‹“å±•å­—æ®µï¼‰

   * â€œServer Helloâ€ï¼ˆç‰ˆæœ¬å·ã€éšæœºæ•°ï¼ˆServer Randomï¼‰ã€é€‰æ‹©çš„å¯†ç å¥—ä»¶ï¼‰

     ~~~java
     Handshake Protocol: Server Hello
         Version: TLS 1.2 (0x0303)
         Random: 12d2bce6568b063d3dee2â€¦
         Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)
         Extension: supported_versions (len=2)
             Supported Version: TLS 1.3 (0x0304)
         Extension: key_share (len=36)
             Key Share extension
                 Key Share Entry: Group: x25519, Key Exchange length: 32
     ~~~

     > è¡¨é¢ä¸Šçœ‹å’Œ TLS1.2 æ˜¯ä¸€æ ·çš„ï¼Œé‡ç‚¹æ˜¯åé¢çš„æ‰©å±•ã€‚â€œsupported_versionsâ€é‡Œç¡®è®¤ä½¿ç”¨çš„æ˜¯ TLS1.3ï¼Œç„¶ååœ¨â€œkey_shareâ€æ‰©å±•å¸¦ä¸Šæ›²çº¿å’Œå¯¹åº”çš„å…¬é’¥å‚æ•°ã€‚

     > è¿™æ—¶åªäº¤æ¢äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±æ‹¿åˆ°äº†å››ä¸ªå…±äº«ä¿¡æ¯ï¼šClient Random å’Œ Server Randomã€Client Params å’Œ Server Paramsï¼Œä¸¤è¾¹å°±å¯ä»¥å„è‡ªç”¨ ECDHE ç®—å‡ºâ€œPre-Masterâ€ï¼Œå†ç”¨ HKDF ç”Ÿæˆä¸»å¯†é’¥â€œMaster Secretâ€ï¼Œæ•ˆç‡æ¯” TLS1.2 æé«˜äº†ä¸€å¤§æˆªã€‚

   * â€œChange Cipher Specâ€ï¼ŒåŠ å¯†é€šè®¯ç”Ÿæ•ˆ

   * http-over-tlsï¼Œåé¢çš„æ•°æ®éƒ½æ˜¯åŠ å¯†çš„ã€‚

3. ç¬¬ä¸‰ä¸ªåŒ…ï¼šå®¢æˆ·ç«¯å‘é€æœåŠ¡ç«¯ï¼ˆçœç•¥ï¼‰

   * â€œChange Cipher Specâ€ï¼ŒåŠ å¯†é€šè®¯ç”Ÿæ•ˆ
   * http-over-tlsï¼Œåé¢çš„æ•°æ®éƒ½æ˜¯åŠ å¯†çš„ã€‚

