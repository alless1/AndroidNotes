#### 内存空间

1. 虚拟机栈：Stack Frame 栈帧

   * 本地方法栈：主要用于处理本地方法（native），和虚拟机栈类似

2. 程序计数器（Program Counter），记录字节码行号，程序跳转。

   > 虚拟机栈和程序计数器属于线程私有。

3. 堆（Heap）：JVM管理的最大一块内存空间。新生代、老年代。

4. 方法区（Method Area）：存储元信息。永久代（Permanent Generation），从JDK1.0开始，已经彻底废弃了永久代，使用元空间（meta space）

   * 运行时常量池：方法区的一部分内容

5. 直接内存：Direct Memory（操作系统管理的），与Java NIO密切相关，JVM通过堆上的DirectByteBuffer来操作直接内存。

#### 创建对象过程

new关键字创建对象的3个步骤：

1. 在堆内存中创建出对象的实例。
   * 指针碰撞：前提是堆中的空间通过一个指针进行分割，一侧是已经被占用的空间，另一侧是未被占用的空间。（垃圾回收器会移动对象）
   * 空闲列表：前提是堆内存空间中已被使用与未被使用的空间是交织在一起的，这时，虚拟机就需要通过一个列表来记录哪些空间是可以使用的，哪些空间是已被使用的，接下来找出可以容纳下新创建对象且未被使用的空间，在此空间存放该对象，同时还要修改列表上的记录。
2. 为对象的实例成员变量赋初值。
   * 调用<init>方法。
3. 将对象的引用返回。

#### 对象的结构

1. 对象头：hash数据，分代信息
2. 实例数据，在一个类中所声明的各项信息。
3. 对齐填充（可选）

#### VM Option

* -Xms128m（最小heap内存）
* -Xmx256m（最大heap内存）
* -XX:+HeapDumpOnOutOfMemoryError（打印oom信息）
* -Xss160k（堆栈的大小，最少160k以上）



